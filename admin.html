<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° - å¹¸è¿é™ä¸´</title>
    <script>
        // è¶…çº§ç®¡ç†å‘˜éªŒè¯ - æ¯æ¬¡è®¿é—®éƒ½éœ€è¦é‡æ–°è®¤è¯
        async function checkSuperAdminAccess() {
            // æ¸…é™¤ä»»ä½•å¯èƒ½å­˜åœ¨çš„æœ¬åœ°è®¤è¯çŠ¶æ€
            sessionStorage.removeItem('superAdminVerified');
            localStorage.removeItem('superAdminVerified');
            
            try {
                const response = await fetch('server/api/super-admin.php?action=check');
                const data = await response.json();
                
                if (!data.authenticated) {
                    alert('éœ€è¦è¶…çº§ç®¡ç†å‘˜æƒé™è®¿é—®æ­¤é¡µé¢ï¼è¯·é‡æ–°è¿›è¡Œèº«ä»½éªŒè¯ã€‚');
                    // å¼ºåˆ¶æ¸…é™¤æœåŠ¡å™¨ç«¯ä¼šè¯
                    await clearServerSession();
                    window.location.href = 'super-admin.html';
                    return false;
                }
                
                // æ˜¾ç¤ºè¶…çº§ç®¡ç†å‘˜ä¿¡æ¯
                document.addEventListener('DOMContentLoaded', function() {
                    const headerP = document.querySelector('.admin-header p');
                    if (headerP) {
                        headerP.textContent = `æ¬¢è¿ï¼Œè¶…çº§ç®¡ç†å‘˜ï¼š${data.admin.username}`;
                    }
                });
                
                return true;
            } catch (error) {
                console.error('éªŒè¯å¤±è´¥:', error);
                alert('éªŒè¯ç³»ç»Ÿé”™è¯¯ï¼Œè¯·é‡æ–°ç™»å½•ï¼');
                await clearServerSession();
                window.location.href = 'super-admin.html';
                return false;
            }
        }
        
        // æ¸…é™¤æœåŠ¡å™¨ç«¯ä¼šè¯
        async function clearServerSession() {
            try {
                await fetch('server/api/super-admin.php?action=logout', {
                    method: 'POST'
                });
            } catch (error) {
                console.error('æ¸…é™¤ä¼šè¯å¤±è´¥:', error);
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶ç«‹å³éªŒè¯
        checkSuperAdminAccess();
        
        // æ·»åŠ é¡µé¢å¯è§æ€§å˜åŒ–ç›‘å¬ï¼Œå½“é¡µé¢é‡æ–°è·å¾—ç„¦ç‚¹æ—¶é‡æ–°éªŒè¯
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                checkSuperAdminAccess();
            }
        });
        
        // æ·»åŠ çª—å£ç„¦ç‚¹äº‹ä»¶ç›‘å¬
        window.addEventListener('focus', function() {
            checkSuperAdminAccess();
        });
        
        // é€€å‡ºç™»å½•å‡½æ•°
        async function logoutSuperAdmin() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿé€€å‡ºåéœ€è¦é‡æ–°è¿›è¡Œèº«ä»½éªŒè¯ã€‚')) {
                try {
                    await fetch('server/api/super-admin.php?action=logout', {
                        method: 'POST'
                    });
                    
                    // æ¸…é™¤æœ¬åœ°çŠ¶æ€
                    sessionStorage.clear();
                    localStorage.clear();
                    
                    alert('å·²å®‰å…¨é€€å‡ºï¼');
                    window.location.href = 'super-admin.html';
                } catch (error) {
                    console.error('é€€å‡ºç™»å½•å¤±è´¥:', error);
                    alert('é€€å‡ºç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0c0c0c, #1a1a1a);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 50px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }
        
        .header-content {
            flex: 1;
        }

        .admin-header h1 {
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            font-size: 48px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .admin-header p {
            color: #ccc;
            font-size: 18px;
        }
        
        .logout-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(255, 107, 107, 0.2);
            border: 2px solid #ff6b6b;
            color: #ff6b6b;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: rgba(255, 107, 107, 0.3);
            box-shadow: 0 0 15px rgba(255, 107, 107, 0.3);
        }

        .admin-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            max-width: 800px;
            width: 100%;
            padding: 0 20px;
        }

        .menu-card {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #ffd700;
            border-radius: 20px;
            padding: 40px 30px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .menu-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
            background: rgba(255, 215, 0, 0.1);
        }

        .menu-icon {
            font-size: 60px;
            margin-bottom: 20px;
            color: #ffd700;
        }

        .menu-title {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 15px;
        }

        .menu-description {
            color: #ccc;
            font-size: 14px;
            line-height: 1.5;
        }

        .back-btn {
            position: fixed;
            top: 30px;
            left: 30px;
            padding: 12px 24px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #000;
            text-decoration: none;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        @media (max-width: 768px) {
            .admin-header h1 {
                font-size: 36px;
            }

            .admin-menu {
                grid-template-columns: 1fr;
                max-width: 400px;
            }

            .menu-card {
                padding: 30px 20px;
            }

            .menu-icon {
                font-size: 48px;
            }

            .menu-title {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <a href="/" class="back-btn">â† è¿”å›ä¸»é¡µ</a>

    <div class="admin-header">
        <div class="header-content">
            <h1 onclick="goToHome()">ç®¡ç†åå°</h1>
            <p>ç³»ç»Ÿç®¡ç†ä¸é…ç½®ä¸­å¿ƒ</p>
        </div>
        <button class="logout-btn" onclick="logoutSuperAdmin()">ğŸ”’ é€€å‡ºç™»å½•</button>
    </div>

    <div class="admin-menu">
        <a href="admin-users.html" class="menu-card">
            <div class="menu-icon">ğŸ‘¥</div>
            <div class="menu-title">ç”¨æˆ·ç®¡ç†</div>
            <div class="menu-description">
                ç®¡ç†ç”¨æˆ·è´¦æˆ·ã€æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ã€ç¼–è¾‘ç”¨æˆ·èµ„æ–™å’Œæƒé™è®¾ç½®
            </div>
        </a>

        <a href="admin-draws.html" class="menu-card">
            <div class="menu-icon">ğŸ²</div>
            <div class="menu-title">æŠ½å¥–è®°å½•</div>
            <div class="menu-description">
                æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çš„æŠ½å¥–è®°å½•ã€ä½™é¢å˜åŠ¨å’Œè¯¦ç»†äº¤æ˜“ä¿¡æ¯
            </div>
        </a>

        <div class="menu-card" onclick="showPrizePageSelector()">
            <div class="menu-icon">ğŸ</div>
            <div class="menu-title">å¥–å“ç®¡ç†</div>
            <div class="menu-description">
                ç®¡ç†æ¸¸æˆå¥–å“ã€ä¿®æ”¹å¥–å“å›¾ç‰‡ã€è®¾ç½®ä¸­å¥–æ¦‚ç‡å’Œå¥–å“ä»·å€¼
            </div>
        </div>
    <!-- å¥–å“é¡µé¢é€‰æ‹©å¼¹çª— -->
    <div id="prizePageModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.7);z-index:2000;align-items:center;justify-content:center;">
        <div style="background:#222;padding:30px 40px;border-radius:20px;max-width:90vw;min-width:400px;box-shadow:0 0 30px #ffd700;">
            <h2 style="color:#ffd700;text-align:center;margin-bottom:20px;">Luckyé¡µé¢ç®¡ç†</h2>
            
            <!-- ç®¡ç†æŒ‰é’® -->
            <div style="display:flex;gap:10px;justify-content:center;margin-bottom:20px;">
                <button onclick="showCreateLuckyModal()" style="padding:8px 16px;border-radius:15px;background:#4ade80;color:#000;font-weight:bold;border:none;cursor:pointer;">åˆ›å»ºæ–°Lucky</button>
                <button onclick="showRenameLuckyModal()" style="padding:8px 16px;border-radius:15px;background:#f59e0b;color:#000;font-weight:bold;border:none;cursor:pointer;">é‡å‘½åLucky</button>
                <button onclick="showDeleteLuckyModal()" style="padding:8px 16px;border-radius:15px;background:#ef4444;color:#fff;font-weight:bold;border:none;cursor:pointer;">åˆ é™¤Lucky</button>
            </div>
            
            <div id="luckyPageList" style="display:flex;flex-wrap:wrap;gap:20px;justify-content:center;"></div>
            <div style="text-align:center;margin-top:20px;">
                <button onclick="closePrizePageModal()" style="padding:10px 30px;border-radius:20px;background:#ffd700;color:#222;font-weight:bold;border:none;cursor:pointer;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- åˆ›å»ºLuckyé¡µé¢å¼¹çª— -->
    <div id="createLuckyModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.8);z-index:2100;align-items:center;justify-content:center;">
        <div style="background:#222;padding:30px;border-radius:20px;max-width:500px;width:90%;box-shadow:0 0 30px #4ade80;">
            <h2 style="color:#4ade80;text-align:center;margin-bottom:20px;">åˆ›å»ºæ–°Luckyé¡µé¢</h2>
            <form id="createLuckyForm">
                <div style="margin-bottom:15px;">
                    <label style="color:#fff;display:block;margin-bottom:5px;">æ–‡ä»¶å (luckyå¼€å¤´):</label>
                    <input type="text" id="luckyFileName" placeholder="ä¾‹å¦‚: lucky5" style="width:100%;padding:8px;border-radius:5px;border:1px solid #4ade80;background:#333;color:#fff;" required>
                    <small style="color:#ccc;">å°†è‡ªåŠ¨æ·»åŠ .htmlåç¼€</small>
                </div>
                <div style="margin-bottom:20px;">
                    <label style="color:#fff;display:block;margin-bottom:5px;">é¡µé¢æ˜¾ç¤ºåç§°:</label>
                    <input type="text" id="luckyDisplayName" placeholder="ä¾‹å¦‚: å¤§çº¢è¡ŒåŠ¨5" style="width:100%;padding:8px;border-radius:5px;border:1px solid #4ade80;background:#333;color:#fff;" required>
                </div>
                <div style="text-align:center;gap:10px;display:flex;justify-content:center;">
                    <button type="submit" style="padding:10px 20px;border-radius:15px;background:#4ade80;color:#000;font-weight:bold;border:none;cursor:pointer;">åˆ›å»º</button>
                    <button type="button" onclick="closeCreateLuckyModal()" style="padding:10px 20px;border-radius:15px;background:#6b7280;color:#fff;font-weight:bold;border:none;cursor:pointer;">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- é‡å‘½åLuckyé¡µé¢å¼¹çª— -->
    <div id="renameLuckyModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.8);z-index:2100;align-items:center;justify-content:center;">
        <div style="background:#222;padding:30px;border-radius:20px;max-width:500px;width:90%;box-shadow:0 0 30px #f59e0b;">
            <h2 style="color:#f59e0b;text-align:center;margin-bottom:20px;">é‡å‘½åLuckyé¡µé¢</h2>
            <form id="renameLuckyForm">
                <div style="margin-bottom:15px;">
                    <label style="color:#fff;display:block;margin-bottom:5px;">é€‰æ‹©è¦é‡å‘½åçš„é¡µé¢:</label>
                    <select id="renameSelectPage" style="width:100%;padding:8px;border-radius:5px;border:1px solid #f59e0b;background:#333;color:#fff;" required>
                        <option value="">è¯·é€‰æ‹©é¡µé¢</option>
                    </select>
                </div>
                <div style="margin-bottom:15px;">
                    <label style="color:#fff;display:block;margin-bottom:5px;">æ–°æ–‡ä»¶å (luckyå¼€å¤´):</label>
                    <input type="text" id="newLuckyFileName" placeholder="ä¾‹å¦‚: lucky6" style="width:100%;padding:8px;border-radius:5px;border:1px solid #f59e0b;background:#333;color:#fff;" required>
                </div>
                <div style="margin-bottom:20px;">
                    <label style="color:#fff;display:block;margin-bottom:5px;">æ–°é¡µé¢æ˜¾ç¤ºåç§°:</label>
                    <input type="text" id="newLuckyDisplayName" placeholder="ä¾‹å¦‚: å¤§çº¢è¡ŒåŠ¨6" style="width:100%;padding:8px;border-radius:5px;border:1px solid #f59e0b;background:#333;color:#fff;" required>
                </div>
                <div style="text-align:center;gap:10px;display:flex;justify-content:center;">
                    <button type="submit" style="padding:10px 20px;border-radius:15px;background:#f59e0b;color:#000;font-weight:bold;border:none;cursor:pointer;">é‡å‘½å</button>
                    <button type="button" onclick="closeRenameLuckyModal()" style="padding:10px 20px;border-radius:15px;background:#6b7280;color:#fff;font-weight:bold;border:none;cursor:pointer;">å–æ¶ˆ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- åˆ é™¤Luckyé¡µé¢å¼¹çª— -->
    <div id="deleteLuckyModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.8);z-index:2100;align-items:center;justify-content:center;">
        <div style="background:#222;padding:30px;border-radius:20px;max-width:500px;width:90%;box-shadow:0 0 30px #ef4444;">
            <h2 style="color:#ef4444;text-align:center;margin-bottom:20px;">åˆ é™¤Luckyé¡µé¢</h2>
            <div style="margin-bottom:15px;">
                <label style="color:#fff;display:block;margin-bottom:5px;">é€‰æ‹©è¦åˆ é™¤çš„é¡µé¢:</label>
                <select id="deleteSelectPage" style="width:100%;padding:8px;border-radius:5px;border:1px solid #ef4444;background:#333;color:#fff;" required>
                    <option value="">è¯·é€‰æ‹©é¡µé¢</option>
                </select>
            </div>
            <div style="color:#ef4444;margin-bottom:20px;text-align:center;">
                <strong>è­¦å‘Šï¼šåˆ é™¤æ“ä½œå°†åŒæ—¶åˆ é™¤é¡µé¢æ–‡ä»¶å’Œå¯¹åº”çš„å¥–å“æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼</strong>
            </div>
            <div style="text-align:center;gap:10px;display:flex;justify-content:center;">
                <button onclick="confirmDeleteLucky()" style="padding:10px 20px;border-radius:15px;background:#ef4444;color:#fff;font-weight:bold;border:none;cursor:pointer;">ç¡®è®¤åˆ é™¤</button>
                <button onclick="closeDeleteLuckyModal()" style="padding:10px 20px;border-radius:15px;background:#6b7280;color:#fff;font-weight:bold;border:none;cursor:pointer;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>


        <a href="admin-recharge.html" class="menu-card">
            <div class="menu-icon">ğŸ’°</div>
            <div class="menu-title">å……å€¼ä¿¡æ¯</div>
            <div class="menu-description">
                ç®¡ç†å……å€¼æ¯”ä¾‹è®¾ç½®ã€æŸ¥çœ‹ç”¨æˆ·å……å€¼è®°å½•å’Œé…ç½®æ”¯ä»˜æ–¹å¼
            </div>
        </a>

        <a href="admin-database.html" class="menu-card">
            <div class="menu-icon">ğŸ—„ï¸</div>
            <div class="menu-title">æ•°æ®åº“é…ç½®</div>
            <div class="menu-description">
                æŸ¥çœ‹æ•°æ®åº“çŠ¶æ€ã€æ‰§è¡ŒSQLå‘½ä»¤å’Œç®¡ç†æ•°æ®è¡¨
            </div>
        </a>

        <a href="admin-settings.html" class="menu-card">
            <div class="menu-icon">âš™ï¸</div>
            <div class="menu-title">ç³»ç»Ÿè®¾ç½®</div>
            <div class="menu-description">
                ç³»ç»Ÿé…ç½®ã€æ¸¸æˆå‚æ•°è®¾ç½®å’Œå®‰å…¨ç®¡ç†
            </div>
        </a>
    </div>

    <script>
        function goToHome() {
            window.location.href = '/';
        }

        // å¼¹çª—æ˜¾ç¤ºå¥–å“é¡µé¢é€‰æ‹©
        function showPrizePageSelector() {
            // è·å–luckyé¡µé¢åˆ—è¡¨
            fetchLuckyPages().then(function(pages) {
                const list = document.getElementById('luckyPageList');
                list.innerHTML = '';
                if (pages.length === 0) {
                    list.innerHTML = '<div style="color:#fff;">æœªæ£€æµ‹åˆ°luckyé¡µé¢</div>';
                } else {
                    pages.forEach(function(page) {
                        const btn = document.createElement('button');
                        btn.textContent = page.displayName || page.fileName;
                        btn.style = 'padding:12px 28px;margin:5px;border-radius:18px;background:#ffd700;color:#222;font-weight:bold;border:none;cursor:pointer;font-size:16px;';
                        btn.onclick = function() {
                            window.location.href = `admin-prizes.html?page=${encodeURIComponent(page.fileName)}`;
                        };
                        list.appendChild(btn);
                    });
                }
                document.getElementById('prizePageModal').style.display = 'flex';
            });
        }

        function closePrizePageModal() {
            document.getElementById('prizePageModal').style.display = 'none';
        }

        // æ˜¾ç¤ºåˆ›å»ºLuckyå¼¹çª—
        function showCreateLuckyModal() {
            document.getElementById('createLuckyModal').style.display = 'flex';
        }

        function closeCreateLuckyModal() {
            document.getElementById('createLuckyModal').style.display = 'none';
            document.getElementById('createLuckyForm').reset();
        }

        // æ˜¾ç¤ºé‡å‘½åLuckyå¼¹çª—
        function showRenameLuckyModal() {
            fetchLuckyPages().then(function(pages) {
                const select = document.getElementById('renameSelectPage');
                select.innerHTML = '<option value="">è¯·é€‰æ‹©é¡µé¢</option>';
                pages.forEach(function(page) {
                    const option = document.createElement('option');
                    option.value = page.fileName;
                    option.textContent = `${page.fileName} (${page.displayName || 'æœªå‘½å'})`;
                    select.appendChild(option);
                });
                document.getElementById('renameLuckyModal').style.display = 'flex';
            });
        }

        function closeRenameLuckyModal() {
            document.getElementById('renameLuckyModal').style.display = 'none';
            document.getElementById('renameLuckyForm').reset();
        }

        // æ˜¾ç¤ºåˆ é™¤Luckyå¼¹çª—
        function showDeleteLuckyModal() {
            fetchLuckyPages().then(function(pages) {
                const select = document.getElementById('deleteSelectPage');
                select.innerHTML = '<option value="">è¯·é€‰æ‹©é¡µé¢</option>';
                pages.forEach(function(page) {
                    const option = document.createElement('option');
                    option.value = page.fileName;
                    option.textContent = `${page.fileName} (${page.displayName || 'æœªå‘½å'})`;
                    select.appendChild(option);
                });
                document.getElementById('deleteLuckyModal').style.display = 'flex';
            });
        }

        function closeDeleteLuckyModal() {
            document.getElementById('deleteLuckyModal').style.display = 'none';
        }

        // æ£€æµ‹pagesç›®å½•ä¸‹çš„lucky*.htmlé¡µé¢
        async function fetchLuckyPages() {
            try {
                const response = await fetch('/server/api/admin.php?action=list_lucky_pages');
                const data = await response.json();
                if (data.success) {
                    return data.pages;
                } else {
                    console.error('è·å–Luckyé¡µé¢åˆ—è¡¨å¤±è´¥:', data.error);
                    return [];
                }
            } catch (error) {
                console.error('ç½‘ç»œé”™è¯¯:', error);
                // fallbackåˆ°é™æ€åˆ—è¡¨
                return [
                    {fileName: "lucky1.html", displayName: "å¤§çº¢è¡ŒåŠ¨"},
                    {fileName: "lucky2.html", displayName: "å¤§çº¢è¡ŒåŠ¨2"},
                    {fileName: "lucky3.html", displayName: "å¤§çº¢è¡ŒåŠ¨3"},
                    {fileName: "lucky4.html", displayName: "å¤§çº¢è¡ŒåŠ¨4"}
                ];
            }
        }

        // åˆ›å»ºæ–°Luckyé¡µé¢
        document.getElementById('createLuckyForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const fileName = document.getElementById('luckyFileName').value.trim();
            const displayName = document.getElementById('luckyDisplayName').value.trim();
            
            // éªŒè¯æ–‡ä»¶å
            if (!fileName.startsWith('lucky')) {
                alert('æ–‡ä»¶åå¿…é¡»ä»¥"lucky"å¼€å¤´ï¼');
                return;
            }
            
            if (!/^lucky[a-zA-Z0-9_-]*$/.test(fileName)) {
                alert('æ–‡ä»¶ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦ï¼');
                return;
            }

            try {
                const response = await fetch('/server/api/admin.php?action=create_lucky_page', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        fileName: fileName + '.html',
                        displayName: displayName
                    })
                });

                const data = await response.json();
                if (data.success) {
                    alert('Luckyé¡µé¢åˆ›å»ºæˆåŠŸï¼');
                    closeCreateLuckyModal();
                    // åˆ·æ–°é¡µé¢åˆ—è¡¨
                    showPrizePageSelector();
                } else {
                    alert('åˆ›å»ºå¤±è´¥: ' + data.error);
                }
            } catch (error) {
                console.error('åˆ›å»ºLuckyé¡µé¢å¤±è´¥:', error);
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        });

        // é‡å‘½åLuckyé¡µé¢
        document.getElementById('renameLuckyForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const oldFileName = document.getElementById('renameSelectPage').value;
            const newFileName = document.getElementById('newLuckyFileName').value.trim();
            const newDisplayName = document.getElementById('newLuckyDisplayName').value.trim();
            
            if (!oldFileName) {
                alert('è¯·é€‰æ‹©è¦é‡å‘½åçš„é¡µé¢ï¼');
                return;
            }
            
            // éªŒè¯æ–°æ–‡ä»¶å
            if (!newFileName.startsWith('lucky')) {
                alert('æ–°æ–‡ä»¶åå¿…é¡»ä»¥"lucky"å¼€å¤´ï¼');
                return;
            }
            
            if (!/^lucky[a-zA-Z0-9_-]*$/.test(newFileName)) {
                alert('æ–°æ–‡ä»¶ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œè¿å­—ç¬¦ï¼');
                return;
            }

            try {
                const response = await fetch('/server/api/admin.php?action=rename_lucky_page', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        oldFileName: oldFileName,
                        newFileName: newFileName + '.html',
                        newDisplayName: newDisplayName
                    })
                });

                const data = await response.json();
                if (data.success) {
                    alert('Luckyé¡µé¢é‡å‘½åæˆåŠŸï¼');
                    closeRenameLuckyModal();
                    // åˆ·æ–°é¡µé¢åˆ—è¡¨
                    showPrizePageSelector();
                } else {
                    alert('é‡å‘½åå¤±è´¥: ' + data.error);
                }
            } catch (error) {
                console.error('é‡å‘½åLuckyé¡µé¢å¤±è´¥:', error);
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        });

        // ç¡®è®¤åˆ é™¤Luckyé¡µé¢
        async function confirmDeleteLucky() {
            const fileName = document.getElementById('deleteSelectPage').value;
            
            if (!fileName) {
                alert('è¯·é€‰æ‹©è¦åˆ é™¤çš„é¡µé¢ï¼');
                return;
            }
            
            if (!confirm(`ç¡®å®šè¦åˆ é™¤ ${fileName} å—ï¼Ÿæ­¤æ“ä½œå°†åŒæ—¶åˆ é™¤é¡µé¢æ–‡ä»¶å’Œæ‰€æœ‰ç›¸å…³æ•°æ®ï¼Œä¸”ä¸å¯æ¢å¤ï¼`)) {
                return;
            }

            try {
                const response = await fetch('/server/api/admin.php?action=delete_lucky_page', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        fileName: fileName
                    })
                });

                const data = await response.json();
                if (data.success) {
                    alert('Luckyé¡µé¢åˆ é™¤æˆåŠŸï¼');
                    closeDeleteLuckyModal();
                    // åˆ·æ–°é¡µé¢åˆ—è¡¨
                    showPrizePageSelector();
                } else {
                    alert('åˆ é™¤å¤±è´¥: ' + data.error);
                }
            } catch (error) {
                console.error('åˆ é™¤Luckyé¡µé¢å¤±è´¥:', error);
                alert('ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
    </script>
</body>
</html>
