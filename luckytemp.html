<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¸è¿æ‰è½ - å¤§çº¢è¡ŒåŠ¨</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/neon.css">
    <link rel="stylesheet" href="../css/lucky-page.css">
</head>
<body>
    <div class="particles"></div>
    
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-brand">
            <h1 class="neon-text gold" onclick="goToHome()" style="cursor: pointer;" title="è¿”å›ä¸»é¡µ">å¤§çº¢è¡ŒåŠ¨</h1>
        </div>
        
        <div class="nav-user">
            <!-- ä»“åº“åŠŸèƒ½ -->
            <div class="nav-item warehouse-btn" onclick="window.location.href='modules/container.html'" title="å®ç®±å¯»å®">
                <i class="icon">ğŸ“¦</i>
                <span>ä»“åº“</span>
            </div>
            
            <!-- æ¯æ—¥ç­¾åˆ° -->
            <div class="nav-item checkin-btn" onclick="window.location.href='modules/checkin.html'" title="æ¯æ—¥ç­¾åˆ°">
                <i class="icon">ğŸ“…</i>
                <span>ç­¾åˆ°</span>
            </div>
            
            <div class="user-info" id="userInfo">
                <img id="userAvatar" src="" alt="å¤´åƒ" class="user-avatar">
                <span id="userNickname" class="neon-text"></span>
                <span id="userBalance" class="neon-text gold"></span>
                <a href="user/recharge.html" class="recharge-btn" title="å……å€¼">ğŸ’°</a>
                <div class="user-dropdown">
                    <a href="user/profile.html" class="neon-text">ä¸ªäººä¸­å¿ƒ</a>
                    <a href="main.html" class="neon-text">è¿”å›ä¸»é¡µ</a>
                    <a href="#" onclick="logout()" class="neon-text">é€€å‡ºç™»å½•</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- é™æ—¶æ‰è½çª—å£ -->
    <div id="limitedDropWindow" class="limited-drop-window">
        <div class="limited-drop-header">
            <h3 id="limitedDropTitle" class="neon-text gold">é™æ—¶æ‰è½ï¼Œçˆ†ç‡æå‡</h3>
            <span class="limited-drop-hint">ğŸ’¡ çœŸå®æ•°é‡æ›´æ–°æœ‰å»¶è¿Ÿï¼Œåˆ·æ–°åæŸ¥çœ‹</span>
        </div>
        <div class="limited-drop-content">
            <div id="limitedDropPrizes" class="limited-drop-prizes">
                <!-- é™æ—¶æ‰è½å¥–å“å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <div class="game-container">
        <div class="game-header">
            <h2 class="neon-text rainbow">å¹¸è¿æ‰è½</h2>
            <p class="neon-text">ç¥ç§˜ç¤¼å“ç­‰ä½ æ¥æŠ½ï¼Œè¿æ°”å†³å®šä¸€åˆ‡ï¼</p>
        </div>

        <!-- 3Då±•ç¤ºåŒºåŸŸ - CS2é£æ ¼ -->
        <div class="showcase-area">
            <div class="showcase-glow"></div>
            <div class="showcase-item" id="showcaseItem">
                <div class="showcase-icon">ğŸ</div>
                <div class="showcase-name">å‡†å¤‡å¼€å§‹</div>
                <div class="showcase-price">0.00</div>
            </div>
            <div class="showcase-arrows">
                <div class="arrow-left">
                    <span class="arrow-layer">â€¹</span>
                    <span class="arrow-layer">â€¹</span>
                    <span class="arrow-layer">â€¹</span>
                </div>
                <div class="arrow-right">
                    <span class="arrow-layer">â€º</span>
                    <span class="arrow-layer">â€º</span>
                    <span class="arrow-layer">â€º</span>
                </div>
            </div>
        </div>

        <!-- æŠ½å¥–è®¾ç½® -->
        <div class="draw-settings">
            <div class="draw-mode-selector">
                <button class="mode-btn active" data-mode="1">å•æŠ½</button>
                <button class="mode-btn" data-mode="3">ä¸‰è¿æŠ½</button>
                <button class="mode-btn" data-mode="5">äº”è¿æŠ½</button>
            </div>
            
            <div class="animation-settings">
                <label class="setting-item">
                    <input type="checkbox" id="skipAnimation" class="skip-checkbox">
                    <span class="neon-text">è·³è¿‡åŠ¨ç”»</span>
                </label>
            </div>
        </div>

        <!-- æŠ½å¥–æŒ‰é’® -->
        <div class="slot-controls">
            <button id="spinBtn" class="btn-spin">
                <span class="btn-text">å¼€å§‹æŠ½å¥–</span>
                <span class="btn-cost" id="btnCost">(æ¶ˆè€—: 10)</span>
            </button>
        </div>

        <!-- æ¨ªå‘æ»šåŠ¨è€è™æœº -->
        <div class="horizontal-slot-container">
            <div class="slot-rows" id="slotRows">
                <!-- æŠ½å¥–è¡Œå°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- å¥–å“è¯´æ˜ - å¡ç‰‡å¼å±•ç¤º -->
        <div class="prize-info">
            <h3 class="neon-text gold">ğŸ¯ å¥–åŠ±åˆ—è¡¨</h3>
            <div class="prize-grid" id="prizeGrid">
                <!-- å¥–å“è¯´æ˜å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- æ¯æ—¥ç­¾åˆ°å¼¹çª— -->
    <div id="checkinModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="neon-text gold">æ¯æ—¥ç­¾åˆ°</h3>
                <span class="close" onclick="closeCheckinModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="checkinContent">
                    <div class="checkin-calendar">
                        <div class="calendar-header">
                            <h4 class="neon-text">æœ¬æœˆç­¾åˆ°è®°å½•</h4>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            <!-- æ—¥å†ç½‘æ ¼å°†é€šè¿‡JSç”Ÿæˆ -->
                        </div>
                    </div>
                    <div class="checkin-rewards">
                        <h4 class="neon-text gold">ç­¾åˆ°å¥–åŠ±</h4>
                        <div class="reward-item">
                            <span>è¿ç»­ç­¾åˆ°1å¤©ï¼šé‡‘å¸ +10</span>
                        </div>
                        <div class="reward-item">
                            <span>è¿ç»­ç­¾åˆ°7å¤©ï¼šé‡‘å¸ +100</span>
                        </div>
                        <div class="reward-item">
                            <span>è¿ç»­ç­¾åˆ°30å¤©ï¼šç¥ç§˜ç¤¼å“</span>
                        </div>
                    </div>
                    <button id="checkinBtn" class="btn-checkin" onclick="performCheckin()">
                        ç«‹å³ç­¾åˆ°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä»“åº“å¼¹çª— -->
    <div id="warehouseModal" class="modal">
        <div class="modal-content warehouse-modal">
            <div class="modal-header">
                <h3 class="neon-text gold">æˆ‘çš„ä»“åº“</h3>
                <span class="close" onclick="closeWarehouseModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="warehouse-tabs">
                    <button class="tab-btn active" data-tab="items">ç‰©å“</button>
                    <button class="tab-btn" data-tab="rewards">å¥–åŠ±</button>
                    <button class="tab-btn" data-tab="gifts">ç¤¼å“</button>
                </div>
                <div class="warehouse-content">
                    <div id="warehouseItems" class="warehouse-grid">
                        <!-- ä»“åº“ç‰©å“å°†é€šè¿‡JSç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å¥–æç¤º -->
    <div id="winModal" class="modal">
        <div class="modal-content">
            <h3 class="neon-text gold">æ­å–œä¸­å¥–ï¼</h3>
            <div id="winResult" class="win-result"></div>
            <button onclick="closeWinModal()" class="btn-neon">ç¡®å®š</button>
        </div>
    </div>

    <style>
        /* ä½¿ç”¨çº¢è‰²ä¸»é¢˜çš„è‡ªå®šä¹‰æ ·å¼è¦†ç›– */
        
        /* é™æ—¶æ‰è½çª—å£æ ·å¼ - å½©è™¹éœ“è™¹ç‰¹æ•ˆ */
        .limited-drop-window {
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            width: 100%;
            background: linear-gradient(135deg, rgba(15, 15, 25, 0.98), rgba(20, 20, 35, 0.98));
            backdrop-filter: blur(10px);
            border-bottom: 3px solid transparent;
            background-image: 
                linear-gradient(135deg, rgba(15, 15, 25, 0.98), rgba(20, 20, 35, 0.98)),
                linear-gradient(90deg, #ff0080, #ff8c00, #40e0d0, #9370db, #ff0080);
            background-origin: border-box;
            background-clip: padding-box, border-box;
            z-index: 998;
            transform: translateY(-100%);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }
        
        .limited-drop-window.show {
            transform: translateY(0);
        }
        
        .limited-drop-window.collapsed {
            transform: translateY(calc(-100% + 8px));
        }
        
        .limited-drop-window.collapsed:hover {
            transform: translateY(0);
        }
        
        /* æ·»åŠ ä¸€ä¸ªé¡¶éƒ¨è§¦å‘æ¡ */
        .limited-drop-window::after {
            content: 'â–¼ é™æ—¶æ‰è½ â–¼';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, #ff0080, #ff8c00, #40e0d0, #9370db);
            color: #fff;
            padding: 2px 20px;
            border-radius: 0 0 8px 8px;
            font-size: 11px;
            font-weight: bold;
            letter-spacing: 1px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            white-space: nowrap;
        }
        
        .limited-drop-window.collapsed::after {
            opacity: 1;
        }
        
        /* å½©è™¹è¾¹æ¡†åŠ¨ç”» */
        @keyframes rainbow-border {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .limited-drop-window::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(255, 0, 128, 0.1), 
                rgba(255, 140, 0, 0.1), 
                rgba(64, 224, 208, 0.1), 
                rgba(147, 112, 219, 0.1));
            background-size: 200% 200%;
            animation: rainbow-border 3s ease infinite;
            pointer-events: none;
        }
        
        .limited-drop-header {
            background: linear-gradient(90deg, 
                rgba(255, 0, 128, 0.15), 
                rgba(255, 140, 0, 0.15), 
                rgba(64, 224, 208, 0.15));
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding: 15px 35px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .limited-drop-header h3 {
            margin: 0;
            font-size: 24px;
            background: linear-gradient(90deg, 
                #ff0080, 
                #ff8c00, 
                #40e0d0, 
                #9370db, 
                #ff0080);
            background-size: 200% auto;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbow-text 3s linear infinite;
            font-weight: 700;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
            letter-spacing: 2px;
        }
        
        .limited-drop-hint {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 12px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            white-space: nowrap;
        }
        
        @keyframes rainbow-text {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        
        .close-btn {
            color: #fff;
            opacity: 0.7;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }
        
        .limited-drop-prize .prize-name {
            background: linear-gradient(135deg, #40e0d0, #9370db);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
        }
        
        /* æ¸¸æˆå®¹å™¨ - CS2é£æ ¼æ·±è‰²èƒŒæ™¯ */
        .game-container {
            margin-top: 70px;
            padding: 20px 20px 40px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
            position: relative;
            background: linear-gradient(180deg, 
                rgba(15, 15, 20, 0.95) 0%, 
                rgba(20, 20, 25, 0.98) 50%,
                rgba(15, 15, 20, 0.95) 100%);
        }
        
        /* æ·»åŠ èƒŒæ™¯è£…é¥° - çº¢è‰²æ¸å˜å…‰æ•ˆ */
        .game-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: 50%;
            transform: translateX(-50%);
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, 
                rgba(239, 68, 68, 0.12) 0%, 
                rgba(220, 38, 38, 0.08) 30%,
                transparent 70%);
            pointer-events: none;
            z-index: 0;
            animation: pulse-glow 8s ease-in-out infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 0.5; transform: translateX(-50%) scale(1); }
            50% { opacity: 0.8; transform: translateX(-50%) scale(1.1); }
        }
        
        /* 3Då±•ç¤ºåŒºåŸŸ - CS2é£æ ¼ çº¢è‰²ä¸»é¢˜ */
        .showcase-area {
            position: relative;
            margin: 30px auto;
            padding: 60px 40px;
            max-width: 600px;
            z-index: 1;
            transition: all 0.5s ease;
        }
        
        .showcase-area.hidden {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) scale(0.8);
        }
        
        .showcase-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, 
                rgba(239, 68, 68, 0.25) 0%, 
                rgba(220, 38, 38, 0.15) 30%,
                transparent 70%);
            filter: blur(40px);
            animation: showcase-pulse 3s ease-in-out infinite;
        }
        
        @keyframes showcase-pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
        }
        
        .showcase-item {
            position: relative;
            z-index: 2;
            padding: 50px 40px;
            background: linear-gradient(135deg, 
                rgba(30, 20, 20, 0.6), 
                rgba(20, 15, 15, 0.8));
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 20px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 0 40px rgba(239, 68, 68, 0.2);
            transition: all 0.4s ease;
        }
        
        .showcase-item:hover {
            transform: translateY(-10px);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.15),
                0 0 60px rgba(239, 68, 68, 0.4);
        }
        
        .showcase-icon {
            font-size: 100px;
            margin-bottom: 15px;
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.5));
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }
        
        .showcase-name {
            font-size: 22px;
            font-weight: bold;
            color: #4ade80;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
        }
        
        .showcase-price {
            font-size: 28px;
            font-weight: bold;
            color: #4ade80;
            text-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
        }
        
        .showcase-arrows {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            pointer-events: none;
            z-index: 3;
        }
        
        /* è£…é¥°æ€§ç®­å¤´å®¹å™¨ */
        .arrow-left, .arrow-right {
            display: flex;
            align-items: center;
            gap: 8px;
            pointer-events: none;
        }
        
        /* ç®­å¤´å±‚ - æ‰©æ•£æ•ˆæœ */
        .arrow-layer {
            font-size: 40px;
            font-weight: bold;
            color: rgba(239, 68, 68, 0.6);
            text-shadow: 0 0 15px rgba(239, 68, 68, 0.5);
            animation: arrow-pulse 2s ease-in-out infinite;
            display: inline-block;
        }
        
        /* ä¸ºæ¯ä¸ªç®­å¤´å±‚è®¾ç½®ä¸åŒçš„å»¶è¿Ÿï¼Œåˆ›å»ºæ‰©æ•£æ•ˆæœ */
        .arrow-left .arrow-layer:nth-child(1),
        .arrow-right .arrow-layer:nth-child(1) {
            animation-delay: 0s;
            opacity: 0.8;
        }
        
        .arrow-left .arrow-layer:nth-child(2),
        .arrow-right .arrow-layer:nth-child(2) {
            animation-delay: 0.2s;
            opacity: 0.6;
        }
        
        .arrow-left .arrow-layer:nth-child(3),
        .arrow-right .arrow-layer:nth-child(3) {
            animation-delay: 0.4s;
            opacity: 0.4;
        }
        
        /* ç®­å¤´è„‰åŠ¨åŠ¨ç”» */
        @keyframes arrow-pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 0.4;
                text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
            }
            50% {
                transform: scale(1.2);
                opacity: 0.8;
                text-shadow: 0 0 25px rgba(239, 68, 68, 0.8);
            }
        }
        
        .game-header {
            margin-bottom: 40px;
        }
        
        .game-header h2 {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .game-header p {
            font-size: 18px;
            opacity: 0.8;
        }

        /* æŠ½å¥–è®¾ç½®æ ·å¼ - çº¢è‰²ä¸»é¢˜ */
        .draw-settings {
            margin: 30px 0;
        }
        
        .draw-mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .mode-btn {
            padding: 10px 25px;
            border: 2px solid #ef4444;
            background: transparent;
            color: #4ade80;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 600;
        }
        
        .mode-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .mode-btn.active {
            background: #ef4444;
            color: #fff;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }

        .animation-settings {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        
        .setting-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        
        .setting-item:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .skip-checkbox {
            width: 18px;
            height: 18px;
            accent-color: #ef4444;
            cursor: pointer;
        }
        
        .skip-checkbox:checked + .neon-text {
            color: #ef4444;
            text-shadow: 0 0 10px #ef4444;
        }

        /* æ¨ªå‘æ»šåŠ¨è€è™æœºæ ·å¼ - çº¢è‰²ä¸»é¢˜ + CS2é£æ ¼ */
        .horizontal-slot-container {
            margin: 0;
            padding: 0 10px;
            position: relative;
            z-index: 1;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        
        .horizontal-slot-container.active {
            opacity: 1;
            max-height: 1000px;
            margin: 30px 0;
        }
        
        .slot-rows {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .slot-row {
            position: relative;
            height: 100px;
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(20, 20, 40, 0.8));
            width: 100%;
            min-width: 320px;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .slot-strip {
            display: flex;
            height: 100%;
            transform: translateX(0px);
            transition: none;
            will-change: transform;
            min-width: 100%;
        }
        
        .slot-item {
            flex: 0 0 100px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid rgba(239, 68, 68, 0.15);
            background: linear-gradient(180deg, rgba(239, 68, 68, 0.05), rgba(239, 68, 68, 0.02));
            min-width: 100px;
            transition: all 0.2s ease;
        }
        
        .slot-item:hover {
            background: linear-gradient(180deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
        }
        
        .slot-item:last-child {
            border-right: none;
        }
        
        .slot-item .icon {
            font-size: 32px;
            margin-bottom: 8px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }
        
        .slot-item .name {
            font-size: 11px;
            color: #4ade80;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            padding: 0 4px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        /* ä¸­å¿ƒæŒ‡é’ˆ - çº¢è‰² + å¢å¼ºæ•ˆæœ */
        .slot-pointer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 3px;
            height: 80px;
            background: linear-gradient(to bottom, #ef4444, #dc2626, #ef4444);
            border-radius: 2px;
            box-shadow: 
                0 0 10px #ef4444,
                0 0 20px rgba(239, 68, 68, 0.5),
                0 0 30px rgba(239, 68, 68, 0.3);
            z-index: 10;
            animation: pointer-glow 2s ease-in-out infinite alternate;
        }
        
        .slot-pointer::before {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 12px solid #ef4444;
            filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.8));
        }
        
        .slot-pointer::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 12px solid #ef4444;
            filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.8));
        }
        
        @keyframes pointer-glow {
            0% { 
                box-shadow: 
                    0 0 10px #ef4444,
                    0 0 20px rgba(239, 68, 68, 0.5),
                    0 0 30px rgba(239, 68, 68, 0.3);
            }
            100% { 
                box-shadow: 
                    0 0 20px #ef4444,
                    0 0 40px rgba(239, 68, 68, 0.8),
                    0 0 60px rgba(239, 68, 68, 0.5);
            }
        }
        
        .slot-machine-container {
            margin: 40px 0;
        }
        
        /* æŠ½å¥–æŒ‰é’® - CS2é£æ ¼ çº¢è‰²ä¸»é¢˜ */
        .slot-controls {
            margin: 20px 0 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1;
            position: relative;
        }
        
        .btn-spin {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: 2px solid rgba(239, 68, 68, 0.5);
            padding: 16px 50px;
            border-radius: 50px;
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 8px 25px rgba(239, 68, 68, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-spin::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: left 0.5s ease;
        }
        
        .btn-spin:hover::before {
            left: 100%;
        }
        
        .btn-spin:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 12px 35px rgba(239, 68, 68, 0.6),
                0 0 40px rgba(239, 68, 68, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border-color: rgba(239, 68, 68, 0.8);
        }
        
        .btn-spin:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        .btn-spin:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: linear-gradient(135deg, #6b7280, #4b5563);
            border-color: rgba(107, 114, 128, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-text {
            position: relative;
            z-index: 1;
        }
        
        .btn-cost {
            display: block;
            font-size: 12px;
            opacity: 0.9;
            margin-top: 3px;
            font-weight: 600;
        }
        
        /* å¥–å“åŒºåŸŸ - CS2å¡ç‰‡é£æ ¼ */
        .prize-info {
            margin-top: 80px;
            padding: 50px 30px;
            position: relative;
            z-index: 1;
        }
        
        .prize-info h3 {
            font-size: 28px;
            margin-bottom: 40px;
            text-shadow: 0 2px 10px rgba(74, 222, 128, 0.3);
            letter-spacing: 1px;
        }
        
        .prize-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* CS2é£æ ¼å¡ç‰‡ - çº¢è‰²ä¸»é¢˜ */
        .prize-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 15px;
            background: linear-gradient(135deg, 
                rgba(30, 20, 20, 0.7), 
                rgba(20, 15, 15, 0.9));
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        /* é¡¶éƒ¨æ¸å˜æ¡ - çº¢è‰² */
        .prize-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(239, 68, 68, 0.8), 
                transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        /* æ‚¬æµ®å…‰æ•ˆ - çº¢è‰² */
        .prize-item::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 0;
            height: 0;
            background: radial-gradient(circle, 
                rgba(239, 68, 68, 0.3) 0%, 
                transparent 70%);
            border-radius: 50%;
            transition: all 0.4s ease;
        }
        
        .prize-item:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(239, 68, 68, 0.5);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.6),
                0 0 30px rgba(239, 68, 68, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            background: linear-gradient(135deg, 
                rgba(40, 25, 25, 0.8), 
                rgba(30, 20, 20, 0.95));
        }
        
        .prize-item:hover::before {
            opacity: 1;
        }
        
        .prize-item:hover::after {
            width: 200px;
            height: 200px;
        }
        
        .prize-icon {
            font-size: 48px;
            margin-bottom: 15px;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
            transition: all 0.3s ease;
            z-index: 1;
        }
        
        .prize-item:hover .prize-icon {
            transform: scale(1.1) translateY(-5px);
            filter: drop-shadow(0 8px 20px rgba(239, 68, 68, 0.4));
        }
        
        .prize-name {
            color: #4ade80;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 14px;
            text-shadow: 0 0 8px rgba(74, 222, 128, 0.5);
            z-index: 1;
            text-align: center;
            line-height: 1.3;
        }
        
        .prize-value {
            color: #4ade80;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
            z-index: 1;
        }
        
        /* ç¨€æœ‰åº¦æ ‡ç­¾ */
        .prize-item .prize-rarity {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ef4444;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .warehouse-modal {
            max-width: 600px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            font-size: 30px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .close:hover {
            color: #ef4444;
        }

        /* ç­¾åˆ°å¼¹çª—æ ·å¼ */
        .checkin-calendar {
            margin: 20px 0;
        }

        .calendar-header {
            margin-bottom: 15px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .calendar-day {
            padding: 8px;
            border: 1px solid #444;
            border-radius: 5px;
            font-size: 12px;
            text-align: center;
        }

        .calendar-day.checked {
            background: #4ade80;
            color: #000;
        }

        .calendar-day.today {
            border-color: #ef4444;
            border-width: 2px;
        }

        .checkin-rewards {
            margin: 20px 0;
            text-align: left;
        }

        .reward-item {
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }

        .btn-checkin {
            background: linear-gradient(45deg, #4ade80, #22c55e);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-checkin:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 222, 128, 0.4);
        }

        .btn-checkin:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ä»“åº“å¼¹çª—æ ·å¼ */
        .warehouse-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab-btn {
            padding: 8px 20px;
            border: 2px solid #444;
            background: transparent;
            color: #fff;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            border-color: #ef4444;
            color: #ef4444;
        }

        .warehouse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .warehouse-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #444;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .warehouse-item:hover {
            border-color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.2);
        }

        .warehouse-item-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .warehouse-item-name {
            font-size: 12px;
            color: #4ade80;
            margin-bottom: 5px;
        }

        .warehouse-item-count {
            font-size: 10px;
            opacity: 0.7;
        }
        
        .modal-content h3 {
            font-size: 28px;
            margin-bottom: 20px;
        }
        
        .win-result {
            margin: 30px 0;
            font-size: 48px;
        }
        
        .prize-image {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 5px;
        }
        
        .slot-item-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        
        .slot-item .prize-name {
            font-size: 10px;
            color: #4ade80;
            text-align: center;
            margin-top: 5px;
        }
        
        .slot-item.active {
            background: rgba(239, 68, 68, 0.3);
            border: 2px solid #ef4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }
        
        .prize-item .prize-display {
            margin-bottom: 15px;
        }
        
        .prize-item .prize-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 10px;
        }
        
        .prize-item .prize-rarity {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.7);
        }
        
        .prize-item.common .prize-rarity {
            color: #9ca3af;
        }
        
        .prize-item.rare .prize-rarity {
            color: #3b82f6;
        }
        
        .prize-item.epic .prize-rarity {
            color: #8b5cf6;
        }
        
        .prize-item.legendary .prize-rarity {
            color: #f59e0b;
        }
        
        @keyframes spin {
            0% { transform: translateY(0); }
            100% { transform: translateY(-400%); }
        }
        
        @media (max-width: 768px) {
            .navbar {
                padding: 0 15px;
                height: 60px;
                backdrop-filter: blur(15px);
            }
            
            .nav-brand h1 {
                font-size: 18px;
            }
            
            .nav-user {
                gap: 10px;
            }
            
            .nav-item {
                padding: 6px 12px;
                border-radius: 12px;
                min-width: auto;
            }
            
            .nav-item .icon {
                font-size: 16px;
            }
            
            .nav-item span {
                font-size: 10px;
            }
            
            .user-info {
                gap: 8px;
                padding: 6px 12px;
                border-radius: 20px;
            }
            
            .user-avatar {
                width: 32px;
                height: 32px;
            }
            
            .game-container {
                padding: 20px 15px;
                margin-top: 60px;
            }
            
            .game-header h2 {
                font-size: 32px;
                margin-bottom: 12px;
            }
            
            .game-header p {
                font-size: 16px;
            }
            
            .draw-settings {
                flex-direction: column;
                gap: 15px;
                padding: 15px 5px;
            }
            
            .draw-mode-selector {
                gap: 10px;
            }
            
            .mode-btn {
                padding: 8px 16px;
                font-size: 14px;
            }
            
            .horizontal-slot-container {
                padding: 10px 5px;
                margin: 20px 0;
            }
            
            .slot-rows {
                gap: 8px;
            }
            
            .slot-row {
                height: 70px;
                min-width: 300px;
                margin: 0 auto;
                max-width: 95vw;
                border-radius: 10px;
            }
            
            .slot-strip {
                min-width: 600px; /* ç¡®ä¿è¶³å¤Ÿçš„å®½åº¦æ¥å®¹çº³æ‰€æœ‰å¥–å“ */
            }
            
            .slot-item {
                flex: 0 0 50px;
                height: 70px;
                min-width: 50px;
                max-width: 50px;
            }
            
            .slot-item .icon {
                font-size: 20px;
                margin-bottom: 4px;
            }
            
            .slot-item .name {
                font-size: 9px;
                line-height: 1.1;
                padding: 0 2px;
            }
            
            .slot-pointer {
                width: 3px;
                height: 55px;
            }
            
            .slot-pointer::before,
            .slot-pointer::after {
                border-left-width: 6px;
                border-right-width: 6px;
                border-bottom-width: 8px;
                border-top-width: 8px;
            }
            
            .slot-controls {
                margin-top: 15px;
            }
            
            .btn-spin {
                padding: 12px 30px;
                font-size: 16px;
            }
            
            .prize-info {
                padding: 15px;
            }
            
            .prize-info h3 {
                font-size: 20px;
            }
            
            .prize-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .prize-item {
                padding: 12px;
            }
            
            .prize-name {
                font-size: 14px;
            }
            
            .prize-value {
                font-size: 12px;
            }
            
            .modal-content {
                max-width: 90vw;
                padding: 20px;
                margin: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .navbar {
                padding: 0 10px;
            }
            
            .nav-brand h1 {
                font-size: 16px;
            }
            
            .nav-user {
                gap: 8px;
            }
            
            .nav-item {
                padding: 4px 8px;
            }
            
            .nav-item span {
                display: none;
            }
            
            .user-info {
                padding: 4px 8px;
            }
            
            .game-container {
                padding: 15px 10px;
            }
            
            .game-header h2 {
                font-size: 28px;
            }
            
            .draw-settings {
                padding: 10px 3px;
            }
            
            .mode-btn {
                padding: 6px 12px;
                font-size: 13px;
            }
            
            .horizontal-slot-container {
                padding: 8px 3px;
            }
            
            .slot-rows {
                gap: 6px;
            }
            
            .slot-row {
                height: 40px;
                min-width: 280px;
                max-width: 92vw;
                margin: 0 auto;
                border-radius: 6px;
            }
            
            .slot-strip {
                min-width: 500px; /* ç¡®ä¿è¶³å¤Ÿçš„å®½åº¦æ¥å®¹çº³æ‰€æœ‰å¥–å“ */
            }
            
            .slot-item {
                flex: 0 0 40px;
                height: 40px;
                min-width: 40px;
                max-width: 40px;
            }
            
            .slot-item .icon {
                font-size: 14px;
                margin-bottom: 1px;
            }
            
            .slot-item .name {
                font-size: 7px;
                line-height: 1;
                padding: 0;
            }
            
            .slot-pointer {
                width: 2px;
                height: 30px;
            }
            
            .slot-pointer::before,
            .slot-pointer::after {
                border-left-width: 4px;
                border-right-width: 4px;
                border-bottom-width: 6px;
                border-top-width: 6px;
            }
            
            .btn-spin {
                padding: 10px 25px;
                font-size: 15px;
            }
            
            .prize-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .prize-item {
                padding: 10px;
            }
        }
    </style>

    <script src="../js/api-client.js"></script>
    <script src="../js/effects.js"></script>
    <script>
        let currentUser = null;
        let prizeData = [];
        let currentMode = 1; // å½“å‰æŠ½å¥–æ¨¡å¼ï¼š1å•æŠ½ï¼Œ3ä¸‰è¿æŠ½ï¼Œ5äº”è¿æŠ½
        let drawPrices = { single: 10, triple: 30, quintuple: 50 }; // åŠ¨æ€ä»·æ ¼

        // æ£€æŸ¥ç™»å½•çŠ¶æ€å¹¶åŠ è½½æ•°æ®
        async function initPage() {
            // ç›´æ¥æ£€æŸ¥localStorageä¸­çš„ç™»å½•çŠ¶æ€
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const currentUserData = localStorage.getItem('currentUser');
            
            if (isLoggedIn !== 'true' || !currentUserData) {
                alert('è¯·å…ˆç™»å½•ï¼');
                window.location.href = 'auth/login.html';
                return;
            }
            
            try {
                currentUser = JSON.parse(currentUserData);
                console.log('å½“å‰ç”¨æˆ·:', currentUser);
            } catch (e) {
                alert('ç”¨æˆ·ä¿¡æ¯å¼‚å¸¸ï¼Œè¯·é‡æ–°ç™»å½•ï¼');
                window.location.href = 'auth/login.html';
                return;
            }
            
            await loadUserInfo();
            await loadPrizes();
            await loadDrawPrices(); // åŠ è½½æŠ½å¥–ä»·æ ¼
            await initLimitedDrop(); // åˆå§‹åŒ–é™æ—¶æ‰è½
            initSlotMachine();
            bindEvents();
            createParticles();
        }

        // åŠ è½½ç”¨æˆ·ä¿¡æ¯
        async function loadUserInfo() {
            try {
                const result = await api.getUserProfile();
                if (result.success) {
                    const user = result.user;
                    document.getElementById('userAvatar').src = user.avatar;
                    document.getElementById('userNickname').textContent = user.nickname;
                    document.getElementById('userBalance').textContent = `ä½™é¢: ${user.balance}`;
                }
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
            }
        }

        // åŠ è½½å¥–å“æ•°æ®
        async function loadPrizes() {
            try {
                // ä»URLä¸­è·å–å½“å‰é¡µé¢å‚æ•°ï¼Œæˆ–è€…æ ¹æ®æ–‡ä»¶åç¡®å®šé¡µé¢
                const urlParams = new URLSearchParams(window.location.search);
                let currentPage = urlParams.get('page');
                
                // å¦‚æœURLä¸­æ²¡æœ‰pageå‚æ•°ï¼Œå°è¯•ä»æ–‡ä»¶åæ¨æ–­
                if (!currentPage) {
                    const path = window.location.pathname;
                    const filename = path.substring(path.lastIndexOf('/') + 1);
                    currentPage = filename;
                }
                
                // å¦‚æœè¿˜æ˜¯æ²¡æœ‰ï¼Œé»˜è®¤ä½¿ç”¨lucky1.html
                if (!currentPage || currentPage === 'luckytemp.html') {
                    currentPage = 'lucky1.html';
                }
                
                console.log('å½“å‰é¡µé¢:', currentPage);
                
                // ä½¿ç”¨ä¿®æ”¹åçš„APIè°ƒç”¨ï¼Œä¼ å…¥é¡µé¢å‚æ•°
                const result = await api.getPrizes('lucky_drop', currentPage);
                if (result.success) {
                    prizeData = result.prizes;
                    console.log('åŠ è½½çš„å¥–å“æ•°æ®:', prizeData);
                }
            } catch (error) {
                console.error('åŠ è½½å¥–å“æ•°æ®å¤±è´¥:', error);
                // ä½¿ç”¨é»˜è®¤æ•°æ®
                prizeData = [
                    { id: 1, name: 'iPhone 15 Pro', icon: 'ğŸ“±', image_url: '/uploads/prizes/iphone15.jpg', value: 8000, rarity: 'legendary', probability: 1 },
                    { id: 2, name: 'MacBook Air', icon: 'ğŸ’»', image_url: '/uploads/prizes/macbook.jpg', value: 7000, rarity: 'legendary', probability: 1 },
                    { id: 3, name: 'AirPods Pro', icon: 'ğŸ§', image_url: '/uploads/prizes/airpods.jpg', value: 1500, rarity: 'epic', probability: 5 },
                    { id: 4, name: 'iPad', icon: 'ğŸ“±', image_url: '/uploads/prizes/ipad.jpg', value: 3000, rarity: 'epic', probability: 3 },
                    { id: 5, name: 'Apple Watch', icon: 'âŒš', image_url: '/uploads/prizes/watch.jpg', value: 2500, rarity: 'rare', probability: 8 },
                    { id: 6, name: 'è“ç‰™éŸ³å“', icon: 'ğŸ”Š', image_url: '/uploads/prizes/speaker.jpg', value: 500, rarity: 'rare', probability: 15 },
                    { id: 7, name: 'å……ç”µå®', icon: 'ğŸ”‹', image_url: '/uploads/prizes/powerbank.jpg', value: 100, rarity: 'common', probability: 30 },
                    { id: 8, name: 'æ•°æ®çº¿', icon: 'ğŸ”Œ', image_url: '/uploads/prizes/cable.jpg', value: 50, rarity: 'common', probability: 37 }
                ];
            }
            
            generatePrizeGrid();
        }

        // åŠ è½½æŠ½å¥–ä»·æ ¼
        async function loadDrawPrices() {
            try {
                // è·å–å½“å‰é¡µé¢å‚æ•°
                const urlParams = new URLSearchParams(window.location.search);
                let currentPage = urlParams.get('page');
                
                if (!currentPage) {
                    const path = window.location.pathname;
                    const filename = path.substring(path.lastIndexOf('/') + 1);
                    currentPage = filename;
                }
                
                if (!currentPage || currentPage === 'luckytemp.html') {
                    currentPage = 'lucky1.html';
                }
                
                const response = await fetch(`../../server/api/admin.php?action=get_draw_prices&page=${encodeURIComponent(currentPage)}`);
                const data = await response.json();
                
                if (data.success) {
                    drawPrices = data.prices;
                    console.log('åŠ è½½çš„æŠ½å¥–ä»·æ ¼:', drawPrices);
                    
                    // æ›´æ–°æŒ‰é’®åç§°
                    if (data.names) {
                        const singleBtn = document.querySelector('.mode-btn[data-mode="1"]');
                        const tripleBtn = document.querySelector('.mode-btn[data-mode="3"]');
                        const quintupleBtn = document.querySelector('.mode-btn[data-mode="5"]');
                        
                        if (singleBtn && data.names.single) {
                            singleBtn.textContent = data.names.single;
                        }
                        if (tripleBtn && data.names.triple) {
                            tripleBtn.textContent = data.names.triple;
                        }
                        if (quintupleBtn && data.names.quintuple) {
                            quintupleBtn.textContent = data.names.quintuple;
                        }
                    }
                } else {
                    console.warn('åŠ è½½ä»·æ ¼å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤ä»·æ ¼:', data.error);
                }
            } catch (error) {
                console.error('åŠ è½½æŠ½å¥–ä»·æ ¼å¤±è´¥:', error);
            }
        }

        // åˆå§‹åŒ–æ¨ªå‘æ»šåŠ¨è€è™æœº
        function initSlotMachine() {
            updateSlotRows();
        }

        // æ›´æ–°è€è™æœºè¡Œæ•°
        function updateSlotRows() {
            const slotRows = document.getElementById('slotRows');
            slotRows.innerHTML = '';
            
            for (let i = 0; i < currentMode; i++) {
                const row = createSlotRow();
                slotRows.appendChild(row);
            }
            
            // æ›´æ–°æŒ‰é’®æ˜¾ç¤ºçš„æ¶ˆè€— - ä½¿ç”¨åŠ¨æ€ä»·æ ¼
            let cost;
            if (currentMode === 1) {
                cost = drawPrices.single;
            } else if (currentMode === 3) {
                cost = drawPrices.triple;
            } else if (currentMode === 5) {
                cost = drawPrices.quintuple;
            } else {
                cost = currentMode * drawPrices.single; // å¤‡ç”¨è®¡ç®—æ–¹å¼
            }
            
            document.getElementById('btnCost').textContent = `(æ¶ˆè€—: ${cost})`;
        }

        // åˆ›å»ºä¸€è¡Œè€è™æœº
        function createSlotRow() {
            const row = document.createElement('div');
            row.className = 'slot-row';
            
            // åˆ›å»ºæ»šåŠ¨æ¡
            const strip = document.createElement('div');
            strip.className = 'slot-strip';
            
            // åˆ›å»ºä¸­å¿ƒæŒ‡é’ˆ
            const pointer = document.createElement('div');
            pointer.className = 'slot-pointer';
            
            // è®¡ç®—éœ€è¦çš„é‡å¤æ¬¡æ•°ï¼Œç¡®ä¿åœ¨å„ç§å±å¹•å°ºå¯¸ä¸‹éƒ½æœ‰è¶³å¤Ÿçš„å¥–å“
            const isMobile = window.innerWidth <= 768;
            const isSmallMobile = window.innerWidth <= 480;
            const itemWidth = isSmallMobile ? 40 : (isMobile ? 50 : 100);
            const containerWidth = Math.max(window.innerWidth * 0.9, 300);
            const visibleItems = Math.ceil(containerWidth / itemWidth);
            
            // ç¡®ä¿æœ‰è¶³å¤Ÿçš„é¡¹ç›®è®©æ»šåŠ¨çœ‹èµ·æ¥çœŸå®ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šå‡ºç°ç©ºç™½
            const repeatTimes = Math.max(15, visibleItems * 3); // è‡³å°‘é‡å¤15æ¬¡æˆ–3å€å¯è§é¡¹ç›®æ•°
            
            for (let repeat = 0; repeat < repeatTimes; repeat++) {
                for (let i = 0; i < prizeData.length; i++) {
                    const prize = prizeData[i];
                    const item = createSlotItem(prize);
                    strip.appendChild(item);
                }
            }
            
            row.appendChild(strip);
            row.appendChild(pointer);
            
            return row;
        }

        // åˆ›å»ºè€è™æœºé¡¹ç›®
        function createSlotItem(prize) {
            const item = document.createElement('div');
            item.className = 'slot-item';
            item.dataset.prizeId = prize.id;
            
            // æ ¹æ®å±å¹•å°ºå¯¸è®¾ç½®itemå®½åº¦
            const isMobile = window.innerWidth <= 768;
            const isSmallMobile = window.innerWidth <= 480;
            const itemWidth = isSmallMobile ? 40 : (isMobile ? 50 : 100);
            item.style.flex = `0 0 ${itemWidth}px`;
            item.style.minWidth = `${itemWidth}px`;
            item.style.maxWidth = `${itemWidth}px`;
            
            const icon = document.createElement('div');
            icon.className = 'icon';
            
            if (prize.image_url) {
                const img = document.createElement('img');
                img.src = prize.image_url;
                img.alt = prize.name;
                
                // æ ¹æ®å±å¹•å°ºå¯¸è°ƒæ•´å›¾ç‰‡å¤§å°
                const imgSize = isSmallMobile ? '14px' : (isMobile ? '16px' : '32px');
                img.style.width = imgSize;
                img.style.height = imgSize;
                img.style.objectFit = 'cover';
                img.style.borderRadius = '4px';
                img.onerror = () => {
                    img.style.display = 'none';
                    icon.textContent = prize.icon;
                };
                icon.appendChild(img);
            } else {
                icon.textContent = prize.icon;
            }
            
            const name = document.createElement('div');
            name.className = 'name';
            name.textContent = prize.name;
            
            item.appendChild(icon);
            item.appendChild(name);
            
            return item;
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // æ¨¡å¼é€‰æ‹©æŒ‰é’®
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    // æ·»åŠ æ´»åŠ¨çŠ¶æ€
                    e.target.classList.add('active');
                    // è®¾ç½®å½“å‰æ¨¡å¼
                    currentMode = parseInt(e.target.dataset.mode);
                    updateSlotRows();
                });
            });

            // æŠ½å¥–æŒ‰é’®
            document.getElementById('spinBtn').addEventListener('click', startSpin);
            
            // è·³è¿‡åŠ¨ç”»å¤é€‰æ¡† - ä¿å­˜ç”¨æˆ·åå¥½
            const skipCheckbox = document.getElementById('skipAnimation');
            const savedSkipSetting = localStorage.getItem('skipAnimation');
            if (savedSkipSetting === 'true') {
                skipCheckbox.checked = true;
            }
            
            skipCheckbox.addEventListener('change', (e) => {
                localStorage.setItem('skipAnimation', e.target.checked);
            });
        }

        // å¼€å§‹æŠ½å¥–
        async function startSpin() {
            const spinBtn = document.getElementById('spinBtn');
            const skipAnimation = document.getElementById('skipAnimation').checked;
            const showcaseArea = document.querySelector('.showcase-area');
            const slotContainer = document.querySelector('.horizontal-slot-container');
            
            spinBtn.disabled = true;
            spinBtn.querySelector('.btn-text').textContent = 'æŠ½å¥–ä¸­...';
            
            // éšè—å±•ç¤ºåŒºï¼Œæ˜¾ç¤ºæŠ½å¥–åŠ¨ç”»
            showcaseArea.classList.add('hidden');
            slotContainer.classList.add('active');

            try {
                // æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯
                if (!currentUser || !currentUser.id) {
                    throw new Error('ç”¨æˆ·ä¿¡æ¯æ— æ•ˆï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }
                
                // è·å–å½“å‰é¡µé¢å‚æ•°
                const urlParams = new URLSearchParams(window.location.search);
                let currentPage = urlParams.get('page');
                
                // å¦‚æœURLä¸­æ²¡æœ‰pageå‚æ•°ï¼Œå°è¯•ä»æ–‡ä»¶åæ¨æ–­
                if (!currentPage) {
                    const path = window.location.pathname;
                    const filename = path.substring(path.lastIndexOf('/') + 1);
                    currentPage = filename;
                }
                
                // å¦‚æœè¿˜æ˜¯æ²¡æœ‰ï¼Œé»˜è®¤ä½¿ç”¨lucky1.html
                if (!currentPage || currentPage === 'luckytemp.html') {
                    currentPage = 'lucky1.html';
                }
                
                // è°ƒç”¨åç«¯æŠ½å¥–APIï¼Œä¼ é€’é¡µé¢å‚æ•°
                const drawResult = await api.drawPrizes('lucky_drop', currentMode, currentPage);
                
                if (!drawResult.success) {
                    throw new Error(drawResult.message || drawResult.error || 'æŠ½å¥–å¤±è´¥');
                }
                
                // æ‰§è¡ŒåŠ¨ç”»æˆ–è·³è¿‡
                if (skipAnimation) {
                    // ç›´æ¥æ˜¾ç¤ºç»“æœï¼Œè·³è¿‡åŠ¨ç”»
                    showWinResult(drawResult.prizes || drawResult.results, drawResult.total_value);
                    finishSpin(spinBtn, showcaseArea, slotContainer);
                } else {
                    // æ’­æ”¾æ»šåŠ¨åŠ¨ç”»ï¼Œä½¿ç”¨åç«¯è¿”å›çš„ç»“æœ
                    await performSpinWithResults(drawResult.prizes || drawResult.results);
                    
                    // æ˜¾ç¤ºç»“æœ
                    setTimeout(() => {
                        showWinResult(drawResult.prizes || drawResult.results, drawResult.total_value);
                        finishSpin(spinBtn, showcaseArea, slotContainer);
                    }, 4000);
                }
                
            } catch (error) {
                console.error('æŠ½å¥–å¤±è´¥:', error);
                alert(error.message || 'æŠ½å¥–å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ï¼');
                
                finishSpin(spinBtn, showcaseArea, slotContainer);
            }
        }
        
        // å®ŒæˆæŠ½å¥–çš„æ¸…ç†å·¥ä½œ
        function finishSpin(spinBtn, showcaseArea, slotContainer) {
            // é‡ç½®æŒ‰é’®
            spinBtn.disabled = false;
            spinBtn.querySelector('.btn-text').textContent = 'å¼€å§‹æŠ½å¥–';
            
            // æ˜¾ç¤ºå±•ç¤ºåŒºï¼Œéšè—æŠ½å¥–åŠ¨ç”»
            setTimeout(() => {
                showcaseArea.classList.remove('hidden');
                slotContainer.classList.remove('active');
            }, 2000);
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
            loadUserInfo();
            
            // é‡ç½®æ‰€æœ‰stripåˆ°åˆå§‹ä½ç½®ï¼Œä¸ºä¸‹æ¬¡æŠ½å¥–åšå‡†å¤‡
            setTimeout(() => {
                const allStrips = document.querySelectorAll('.slot-strip');
                allStrips.forEach(strip => {
                    strip.style.transition = 'none';
                    strip.style.transform = 'translateX(0px)';
                });
            }, 3000); // ç­‰å¾…3ç§’åé‡ç½®
        }

        // ä½¿ç”¨åç«¯ç»“æœæ‰§è¡ŒæŠ½å¥–åŠ¨ç”»
        async function performSpinWithResults(prizes) {
            const rows = document.querySelectorAll('.slot-row');
            
            // æ­£å¸¸åŠ¨ç”»æµç¨‹
            for (let i = 0; i < rows.length && i < prizes.length; i++) {
                const row = rows[i];
                const strip = row.querySelector('.slot-strip');
                const items = strip.querySelectorAll('.slot-item');
                const winningPrize = prizes[i];
                
                // å¼ºåˆ¶é‡ç½®åˆ°åˆå§‹ä½ç½®
                strip.style.transition = 'none';
                strip.style.transform = 'translateX(0px)';
                
                // å¼ºåˆ¶é‡ç»˜
                strip.offsetHeight;
                
                // æ‰¾åˆ°ç›®æ ‡å¥–å“çš„ç´¢å¼• - ä½¿ç”¨åç§°å’Œç¨€æœ‰åº¦åŒ¹é…
                let targetIndex = -1;
                for (let j = 0; j < items.length; j++) {
                    const itemName = items[j].querySelector('.name')?.textContent;
                    if (itemName === winningPrize.name) {
                        targetIndex = j;
                        break;
                    }
                }
                
                // å¦‚æœæ‰¾ä¸åˆ°å®Œå…¨åŒ¹é…çš„ï¼Œå¯»æ‰¾ç›¸åŒç¨€æœ‰åº¦çš„å¥–å“
                if (targetIndex === -1) {
                    for (let j = 0; j < items.length; j++) {
                        const itemId = parseInt(items[j].dataset.prizeId);
                        const matchingPrize = prizeData.find(p => p.id === itemId);
                        if (matchingPrize && matchingPrize.rarity === winningPrize.rarity) {
                            targetIndex = j;
                            break;
                        }
                    }
                }
                
                // æœ€åå¤‡ç”¨æ–¹æ¡ˆï¼šéšæœºé€‰æ‹©ä¸€ä¸ªä½ç½®
                if (targetIndex === -1) {
                    targetIndex = Math.floor(Math.random() * Math.min(10, items.length));
                }
                
                // è®¡ç®—æ»šåŠ¨å‚æ•° - åŠ¨æ€è·å–itemWidth
                const isMobile = window.innerWidth <= 768;
                const isSmallMobile = window.innerWidth <= 480;
                const itemWidth = isSmallMobile ? 40 : (isMobile ? 50 : 100);
                const containerWidth = row.offsetWidth;
                const centerPosition = containerWidth / 2;
                
                const targetItemLeftEdge = targetIndex * itemWidth;
                const targetItemCenter = targetItemLeftEdge + itemWidth / 2;
                const translateAmount = centerPosition - targetItemCenter;
                
                // è°ƒæ•´é¢å¤–æ»šåŠ¨è·ç¦»ï¼Œæ‰‹æœºç«¯å‡å°‘
                const extraDistance = itemWidth * (isSmallMobile ? 10 : (isMobile ? 15 : 20));
                const finalTranslate = translateAmount - extraDistance;
                
                // å¯åŠ¨æ»šåŠ¨åŠ¨ç”»
                setTimeout(() => {
                    strip.style.transition = 'transform 3s ease-out';
                    strip.style.transform = `translateX(${finalTranslate}px)`;
                }, 200 + i * 200);
            }
        }

        // æ ¹æ®æ¦‚ç‡é€‰æ‹©å¥–å“
        function selectPrizeByProbability() {
            const totalProbability = prizeData.reduce((sum, prize) => sum + prize.probability, 0);
            const random = Math.random() * totalProbability;
            
            let accumulator = 0;
            for (const prize of prizeData) {
                accumulator += prize.probability;
                if (random <= accumulator) {
                    return prize;
                }
            }
            
            // å¤‡ç”¨è¿”å›æœ€åä¸€ä¸ªå¥–å“
            return prizeData[prizeData.length - 1];
        }

        // æ˜¾ç¤ºä¸­å¥–ç»“æœ
        function showWinResult(results, totalValue = null) {
            const modal = document.getElementById('winModal');
            const result = document.getElementById('winResult');
            
            // ä½¿ç”¨åç«¯æä¾›çš„æ€»ä»·å€¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è®¡ç®—
            const calculatedValue = totalValue || results.reduce((sum, prize) => sum + parseFloat(prize.value || 0), 0);
            const prizeNames = results.map(p => p.name).join('ã€');
            
            const prizeDisplay = results.map(prize => {
                if (prize.image_url) {
                    return `<img src="${prize.image_url}" alt="${prize.name}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 10px; margin: 0 5px;">`;
                } else {
                    return `<span style="font-size: 60px; margin: 0 5px;">${prize.icon}</span>`;
                }
            }).join('');
            
            result.innerHTML = `
                <div style="margin: 20px 0;">${prizeDisplay}</div>
                <div class="neon-text gold" style="font-size: 24px; margin: 10px 0;">${prizeNames}</div>
                <div class="neon-text green" style="font-size: 20px;">
                    æ­å–œè·å¾—æ€»ä»·å€¼: ${parseFloat(calculatedValue).toFixed(2)} çš„å¥–å“ï¼
                </div>
            `;
            
            modal.classList.add('show');
        }

        // ç”Ÿæˆå¥–å“è¯´æ˜ç½‘æ ¼
        function generatePrizeGrid() {
            const prizeGrid = document.getElementById('prizeGrid');
            
            prizeGrid.innerHTML = prizeData.map(prize => `
                <div class="prize-item ${prize.rarity}">
                    <div class="prize-display">
                        ${prize.image_url ? 
                            `<img src="${prize.image_url}" alt="${prize.name}" class="prize-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                             <span class="prize-icon" style="display:none;">${prize.icon}</span>` :
                            `<span class="prize-icon">${prize.icon}</span>`
                        }
                    </div>
                    <span class="prize-name">${prize.name}</span>
                    <span class="prize-value">ä»·å€¼: ${prize.value}</span>
                    <span class="prize-rarity">${getRarityText(prize.rarity)}</span>
                    <span class="prize-probability">æ¦‚ç‡: ${prize.probability}%</span>
                </div>
            `).join('');
        }

        // è·å–ç¨€æœ‰åº¦æ–‡æœ¬
        function getRarityText(rarity) {
            const rarityMap = {
                'common': 'æ™®é€š',
                'rare': 'ç¨€æœ‰', 
                'epic': 'å²è¯—',
                'legendary': 'ä¼ è¯´'
            };
            return rarityMap[rarity] || 'æ™®é€š';
        }

        // å…³é—­ä¸­å¥–å¼¹çª—
        function closeWinModal() {
            document.getElementById('winModal').classList.remove('show');
            
            // ç¡®ä¿æ‰€æœ‰stripéƒ½é‡ç½®åˆ°åˆå§‹ä½ç½®
            const allStrips = document.querySelectorAll('.slot-strip');
            allStrips.forEach(strip => {
                strip.style.transition = 'none';
                strip.style.transform = 'translateX(0px)';
            });
        }

        // è¿”å›ä¸»é¡µ
        function goToHome() {
            window.location.href = './main.html';
        }

        // é€€å‡ºç™»å½•
        async function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                try {
                    await api.logout();
                    window.location.href = '../pages/auth/login.html';
                } catch (error) {
                    console.error('é€€å‡ºç™»å½•å¤±è´¥:', error);
                    window.location.href = '../pages/auth/login.html';
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', initPage);

        // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œé‡æ–°åˆå§‹åŒ–è€è™æœºï¼ˆå¤„ç†å±å¹•æ—‹è½¬ç­‰æƒ…å†µï¼‰
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                // é‡æ–°åˆå§‹åŒ–è€è™æœºä»¥é€‚åº”æ–°çš„å±å¹•å°ºå¯¸
                if (prizeData && prizeData.length > 0) {
                    updateSlotRows();
                }
            }, 300); // é˜²æŠ–ï¼Œ300msåæ‰§è¡Œ
        });

        // ç›‘å¬è®¾å¤‡æ–¹å‘å˜åŒ–
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                if (prizeData && prizeData.length > 0) {
                    updateSlotRows();
                }
            }, 500); // ç­‰å¾…æ–¹å‘å˜åŒ–å®Œæˆ
        });

        // æ–°å¢åŠŸèƒ½å‡½æ•°

        // æ‰“å¼€æ¯æ—¥ç­¾åˆ°
        function openCheckin() {
            generateCalendar();
            document.getElementById('checkinModal').classList.add('show');
        }

        // å…³é—­æ¯æ—¥ç­¾åˆ°å¼¹çª—
        function closeCheckinModal() {
            document.getElementById('checkinModal').classList.remove('show');
        }

        // ç”Ÿæˆç­¾åˆ°æ—¥å†
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            
            // è·å–æœ¬æœˆç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            // æ¸…ç©ºæ—¥å†
            calendarGrid.innerHTML = '';
            
            // æ·»åŠ æ˜ŸæœŸæ ‡é¢˜
            const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                dayHeader.style.fontWeight = 'bold';
                dayHeader.style.color = '#ffd700';
                calendarGrid.appendChild(dayHeader);
            });
            
            // æ·»åŠ ç©ºç™½å¤©æ•°ï¼ˆæœˆåˆï¼‰
            const startDay = firstDay.getDay();
            for (let i = 0; i < startDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarGrid.appendChild(emptyDay);
            }
            
            // æ·»åŠ æœ¬æœˆå¤©æ•°
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // æ ‡è®°ä»Šå¤©
                if (day === now.getDate()) {
                    dayElement.classList.add('today');
                }
                
                // æ¨¡æ‹Ÿç­¾åˆ°çŠ¶æ€ï¼ˆå®é™…åº”è¯¥ä»æœåŠ¡å™¨è·å–ï¼‰
                if (Math.random() > 0.7) {
                    dayElement.classList.add('checked');
                    dayElement.title = 'å·²ç­¾åˆ°';
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        // æ‰§è¡Œç­¾åˆ°
        async function performCheckin() {
            const btn = document.getElementById('checkinBtn');
            const originalText = btn.textContent;
            
            btn.disabled = true;
            btn.textContent = 'ç­¾åˆ°ä¸­...';
            
            try {
                // æ¨¡æ‹Ÿç­¾åˆ°è¯·æ±‚
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // æˆåŠŸç­¾åˆ°
                btn.textContent = 'ç­¾åˆ°æˆåŠŸï¼';
                btn.style.background = 'linear-gradient(45deg, #22c55e, #16a34a)';
                
                // æ›´æ–°ç”¨æˆ·ä½™é¢
                setTimeout(() => {
                    loadUserInfo();
                    generateCalendar();
                }, 1000);
                
                // 3ç§’åæ¢å¤æŒ‰é’®
                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = originalText;
                    btn.style.background = 'linear-gradient(45deg, #4ade80, #22c55e)';
                }, 3000);
                
            } catch (error) {
                console.error('ç­¾åˆ°å¤±è´¥:', error);
                btn.disabled = false;
                btn.textContent = 'ç­¾åˆ°å¤±è´¥';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            }
        }

        // æ‰“å¼€ä»“åº“
        function openWarehouse() {
            loadWarehouseItems();
            document.getElementById('warehouseModal').classList.add('show');
        }

        // å…³é—­ä»“åº“å¼¹çª—
        function closeWarehouseModal() {
            document.getElementById('warehouseModal').classList.remove('show');
        }

        // åŠ è½½ä»“åº“ç‰©å“
        function loadWarehouseItems() {
            const warehouseItems = document.getElementById('warehouseItems');
            
            // æ¨¡æ‹Ÿä»“åº“æ•°æ®
            const items = [
                { id: 1, name: 'iPhone 15', icon: 'ğŸ“±', count: 1 },
                { id: 2, name: 'AirPods', icon: 'ğŸ§', count: 2 },
                { id: 3, name: 'å……ç”µå®', icon: 'ğŸ”‹', count: 5 },
                { id: 4, name: 'æ•°æ®çº¿', icon: 'ğŸ”Œ', count: 3 },
                { id: 5, name: 'é‡‘å¸', icon: 'ğŸª™', count: 150 },
                { id: 6, name: 'é’»çŸ³', icon: 'ğŸ’', count: 8 }
            ];
            
            const itemsHtml = items.map(item => `
                <div class="warehouse-item">
                    <div class="warehouse-item-icon">${item.icon}</div>
                    <div class="warehouse-item-name">${item.name}</div>
                    <div class="warehouse-item-count">x${item.count}</div>
                </div>
            `).join('');
            
            warehouseItems.innerHTML = itemsHtml;
        }

        // ä»“åº“æ ‡ç­¾åˆ‡æ¢
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('tab-btn')) {
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                e.target.classList.add('active');
                
                // é‡æ–°åŠ è½½å¯¹åº”å†…å®¹
                loadWarehouseItems();
            }
        });

        // ä¸ªäººä¸­å¿ƒè·³è½¬
        function goToProfile() {
            window.location.href = '../user/profile.html';
        }

        // ==================== é™æ—¶æ‰è½åŠŸèƒ½ ====================
        let limitedDropConfig = null;
        let limitedDropPrizes = [];
        let limitedDropInterval = null;
        
        // åŠ¨æ€è·å–å½“å‰é¡µé¢åç§°
        function getCurrentPageName() {
            const path = window.location.pathname;
            const filename = path.substring(path.lastIndexOf('/') + 1);
            const pageName = filename.replace('.html', '');
            
            // å¦‚æœæ˜¯æ¨¡æ¿é¡µé¢ï¼Œè¿”å›luckytempï¼Œå¦åˆ™è¿”å›å®é™…é¡µé¢å
            return pageName === 'luckytemp' ? 'luckytemp' : pageName;
        }
        
        const currentPageName = getCurrentPageName(); // å½“å‰é¡µé¢åç§°
        console.log('å½“å‰é¡µé¢åç§°:', currentPageName);

        // åˆå§‹åŒ–é™æ—¶æ‰è½
        async function initLimitedDrop() {
            try {
                console.log('åˆå§‹åŒ–é™æ—¶æ‰è½åŠŸèƒ½ï¼Œé¡µé¢:', currentPageName);
                
                // è·å–é…ç½®
                const configResponse = await fetch(`/server/api/limited-drop.php?action=get_config&page=${currentPageName}`);
                const configResult = await configResponse.json();
                
                if (configResult.success && configResult.config) {
                    limitedDropConfig = configResult.config;
                    console.log('é™æ—¶æ‰è½é…ç½®:', limitedDropConfig);
                    
                    // å¦‚æœå¼€å¯äº†é™æ—¶æ‰è½ï¼Œè·å–å¥–å“æ•°æ®å¹¶æ˜¾ç¤º
                    if (limitedDropConfig.is_active) {
                        await loadLimitedDropPrizes();
                        showLimitedDropWindow();
                        
                        // è®¾ç½®è‡ªåŠ¨åˆ·æ–°é—´éš”ï¼ˆæ¯30ç§’æ›´æ–°ä¸€æ¬¡æ•°æ®ï¼‰
                        limitedDropInterval = setInterval(async () => {
                            await loadLimitedDropPrizes();
                            updateLimitedDropDisplay();
                        }, 30000);
                    } else {
                        hideLimitedDropWindow();
                    }
                } else {
                    console.log('é™æ—¶æ‰è½é…ç½®è·å–å¤±è´¥:', configResult);
                    hideLimitedDropWindow();
                }
            } catch (error) {
                console.error('åˆå§‹åŒ–é™æ—¶æ‰è½å¤±è´¥:', error);
                hideLimitedDropWindow();
            }
        }

        // åŠ è½½é™æ—¶æ‰è½å¥–å“
        async function loadLimitedDropPrizes() {
            try {
                const response = await fetch(`/server/api/limited-drop.php?action=get_display_data&page=${currentPageName}`);
                const result = await response.json();
                
                if (result.success) {
                    limitedDropPrizes = result.prizes || [];
                    console.log('é™æ—¶æ‰è½å¥–å“åŠ è½½æˆåŠŸ:', result);
                } else {
                    console.error('é™æ—¶æ‰è½å¥–å“åŠ è½½å¤±è´¥:', result.message);
                }
            } catch (error) {
                console.error('åŠ è½½é™æ—¶æ‰è½å¥–å“å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºé™æ—¶æ‰è½çª—å£
        function showLimitedDropWindow() {
            if (!limitedDropConfig?.is_active || limitedDropPrizes.length === 0) {
                console.log('é™æ—¶æ‰è½æœªå¯ç”¨æˆ–æ— å¥–å“æ•°æ®:', {
                    config: limitedDropConfig,
                    prizesCount: limitedDropPrizes.length
                });
                hideLimitedDropWindow();
                return;
            }

            const window = document.querySelector('.limited-drop-window');
            const body = document.body;
            
            if (window) {
                // æ›´æ–°çª—å£æ ‡é¢˜
                const titleElement = document.getElementById('limitedDropTitle');
                if (titleElement && limitedDropConfig.window_title) {
                    titleElement.textContent = limitedDropConfig.window_title;
                }
                
                // æ˜¾ç¤ºçª—å£å¹¶æ·»åŠ bodyç±»
                window.classList.add('show');
                window.classList.remove('collapsed');
                body.classList.add('limited-drop-active');
                updateLimitedDropDisplay();
                
                // 3ç§’åè‡ªåŠ¨æ”¶å›åˆ°é¡¶éƒ¨
                setTimeout(() => {
                    window.classList.add('collapsed');
                }, 3000);
                
                console.log('é™æ—¶æ‰è½çª—å£å·²æ˜¾ç¤ºï¼Œ3ç§’åå°†è‡ªåŠ¨æ”¶å›');
            }
        }
        
        // éšè—é™æ—¶æ‰è½çª—å£
        function hideLimitedDropWindow() {
            const window = document.querySelector('.limited-drop-window');
            const body = document.body;
            
            if (window) {
                window.classList.remove('show');
                body.classList.remove('limited-drop-active');
                console.log('é™æ—¶æ‰è½çª—å£å·²éšè—');
            }
        }

        // æ›´æ–°é™æ—¶æ‰è½æ˜¾ç¤ºå†…å®¹
        function updateLimitedDropDisplay() {
            const container = document.querySelector('.limited-drop-prizes');
            if (!container) return;

            container.innerHTML = '';

            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ä¼ è¯´ç‰©å“æ•°é‡éƒ½ä¸º0
            const allLegendaryEmpty = limitedDropPrizes.every(prize => {
                return prize.rarity !== 'legendary' || prize.quantity <= 0;
            });
            
            // å¦‚æœæ‰€æœ‰ä¼ è¯´ç‰©å“éƒ½æ²¡äº†ï¼Œè‡ªåŠ¨å…³é—­é™æ—¶æ‰è½
            if (allLegendaryEmpty && limitedDropPrizes.some(p => p.rarity === 'legendary')) {
                console.log('æ‰€æœ‰ä¼ è¯´ç‰©å“å·²è¢«æŠ½å®Œï¼Œè‡ªåŠ¨å…³é—­é™æ—¶æ‰è½');
                closeLimitedDropAutomatically();
                return;
            }

            limitedDropPrizes.forEach(prize => {
                const prizeElement = createLimitedDropPrizeElement(prize);
                container.appendChild(prizeElement);
            });
        }
        
        // è‡ªåŠ¨å…³é—­é™æ—¶æ‰è½
        async function closeLimitedDropAutomatically() {
            try {
                // è°ƒç”¨åç«¯APIå…³é—­é™æ—¶æ‰è½
                const response = await fetch('/server/api/limited-drop.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'toggle_limited_drop',
                        page: currentPageName,
                        is_active: false
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    console.log('é™æ—¶æ‰è½å·²è‡ªåŠ¨å…³é—­');
                    hideLimitedDropWindow();
                    
                    // æ¸…é™¤å®šæ—¶å™¨
                    if (limitedDropInterval) {
                        clearInterval(limitedDropInterval);
                        limitedDropInterval = null;
                    }
                }
            } catch (error) {
                console.error('è‡ªåŠ¨å…³é—­é™æ—¶æ‰è½å¤±è´¥:', error);
            }
        }

        // åˆ›å»ºé™æ—¶æ‰è½å¥–å“å…ƒç´ 
        function createLimitedDropPrizeElement(prize) {
            const div = document.createElement('div');
            div.className = 'limited-drop-prize';
            
            // ä½¿ç”¨ä»æœåŠ¡å™¨è·å–çš„çˆ†ç‡æ•°æ®
            const originalRate = prize.original_rate || '0.001';
            const boostedRate = prize.boosted_rate || '0.005';
            
            // æ•°é‡è­¦å‘Šæ ·å¼
            const quantityClass = prize.quantity <= 5 ? 'quantity-warning' : '';
            
            // ä¼˜å…ˆä½¿ç”¨å›¾ç‰‡URLï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨emojiå›¾æ ‡
            const prizeImageHtml = prize.image_url 
                ? `<img src="${prize.image_url}" alt="${prize.name}" class="prize-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                   <div class="prize-icon" style="display:none;">${prize.icon || 'ğŸ'}</div>`
                : `<div class="prize-icon">${prize.icon || 'ğŸ'}</div>`;
            
            div.innerHTML = `
                ${prizeImageHtml}
                <div class="prize-name">${prize.name}</div>
                <div class="prize-price">ğŸ’° ${prize.value || prize.price || '0'}</div>
                <div class="prize-quantity ${quantityClass}">
                    å‰©ä½™: ${prize.quantity}
                </div>
                <div class="prize-boost">
                    çˆ†ç‡: ${originalRate}% â†’ ${boostedRate}%
                </div>
            `;
            
            // æ·»åŠ ç‚¹å‡»æ•ˆæœ
            div.addEventListener('click', () => {
                console.log('ç‚¹å‡»äº†å¥–å“:', prize.name);
                showPrizeDetailEffect(div);
            });
            
            return div;
        }

        // å¥–å“ç‚¹å‡»ç‰¹æ•ˆ
        function showPrizeDetailEffect(element) {
            element.style.transform = 'translateY(-8px) scale(1.05)';
            element.style.boxShadow = '0 20px 40px rgba(255, 215, 0, 0.6)';
            
            setTimeout(() => {
                element.style.transform = '';
                element.style.boxShadow = '';
            }, 300);
        }

        // å…³é—­é™æ—¶æ‰è½çª—å£ï¼ˆä¿ç•™å‡½æ•°ä½†ä¸æ‰§è¡Œå…³é—­æ“ä½œï¼‰
        function closeLimitedDropWindow() {
            console.log('é™æ—¶æ‰è½çª—å£ä¸å¯å…³é—­');
        }

        // æ‰‹åŠ¨åˆ‡æ¢é™æ—¶æ‰è½çª—å£ï¼ˆä»…ç”¨äºè°ƒè¯•ï¼‰
        function toggleLimitedDropWindow() {
            const window = document.querySelector('.limited-drop-window');
            if (window) {
                if (window.classList.contains('show')) {
                    hideLimitedDropWindow();
                } else {
                    if (limitedDropConfig?.is_active && limitedDropPrizes.length > 0) {
                        showLimitedDropWindow();
                    } else {
                        console.log('é™æ—¶æ‰è½åŠŸèƒ½æœªå¯ç”¨æˆ–æ— å¥–å“æ•°æ®');
                    }
                }
            }
        }

        // æ¸…ç†å®šæ—¶å™¨
        window.addEventListener('beforeunload', () => {
            if (limitedDropInterval) {
                clearInterval(limitedDropInterval);
            }
        });

        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ§åˆ¶ï¼ˆF2åˆ‡æ¢é™æ—¶æ‰è½çª—å£ï¼‰
        document.addEventListener('keydown', (e) => {
            if (e.key === 'F2') {
                e.preventDefault();
                toggleLimitedDropWindow();
            }
        });
    </script>
</body>
</html>