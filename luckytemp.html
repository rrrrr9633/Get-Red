<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âπ∏ËøêÊéâËêΩ - Â§ßÁ∫¢Ë°åÂä®</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/neon.css">
    <link rel="stylesheet" href="../css/lucky-page.css">
</head>
<body>
    <div class="particles"></div>
    
    <!-- ÂØºËà™Ê†è -->
    <nav class="navbar">
        <div class="nav-brand">
            <h1 class="neon-text gold" onclick="goToHome()" style="cursor: pointer;" title="ËøîÂõû‰∏ªÈ°µ">Â§ßÁ∫¢Ë°åÂä®</h1>
        </div>
        
        <div class="nav-user">
            <!-- ‰ªìÂ∫ìÂäüËÉΩ -->
            <div class="nav-item warehouse-btn" onclick="window.location.href='modules/container.html'" title="ÂÆùÁÆ±ÂØªÂÆù">
                <i class="icon">üì¶</i>
                <span>‰ªìÂ∫ì</span>
            </div>
            
            <!-- ÊØèÊó•Á≠æÂà∞ -->
            <div class="nav-item checkin-btn" onclick="window.location.href='modules/checkin.html'" title="ÊØèÊó•Á≠æÂà∞">
                <i class="icon">üìÖ</i>
                <span>Á≠æÂà∞</span>
            </div>
            
            <div class="user-info" id="userInfo">
                <img id="userAvatar" src="" alt="Â§¥ÂÉè" class="user-avatar">
                <span id="userNickname" class="neon-text"></span>
                <span id="userBalance" class="neon-text gold"></span>
                <a href="user/recharge.html" class="recharge-btn" title="ÂÖÖÂÄº">üí∞</a>
                <div class="user-dropdown">
                    <a href="user/profile.html" class="neon-text">‰∏™‰∫∫‰∏≠ÂøÉ</a>
                    <a href="main.html" class="neon-text">ËøîÂõû‰∏ªÈ°µ</a>
                    <a href="#" onclick="logout()" class="neon-text">ÈÄÄÂá∫ÁôªÂΩï</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- ÈôêÊó∂ÊéâËêΩÁ™óÂè£ -->
    <div id="limitedDropWindow" class="limited-drop-window">
        <div class="limited-drop-header">
            <h3 id="limitedDropTitle" class="neon-text gold">ÈôêÊó∂ÊéâËêΩÔºåÁàÜÁéáÊèêÂçá</h3>
            <span class="limited-drop-hint">üí° ÁúüÂÆûÊï∞ÈáèÊõ¥Êñ∞ÊúâÂª∂ËøüÔºåÂà∑Êñ∞ÂêéÊü•Áúã</span>
        </div>
        <div class="limited-drop-content">
            <div id="limitedDropPrizes" class="limited-drop-prizes">
                <!-- ÈôêÊó∂ÊéâËêΩÂ•ñÂìÅÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>
    </div>

    <div class="game-container">
        <div class="game-header">
            <h2 class="neon-text rainbow">Âπ∏ËøêÊéâËêΩ</h2>
            <p class="neon-text">Á•ûÁßòÁ§ºÂìÅÁ≠â‰Ω†Êù•ÊäΩÔºåËøêÊ∞îÂÜ≥ÂÆö‰∏ÄÂàáÔºÅ</p>
        </div>

        <!-- 3DÂ±ïÁ§∫Âå∫Âüü - CS2È£éÊ†º -->
        <div class="showcase-area">
            <div class="showcase-glow"></div>
            <div class="showcase-item" id="showcaseItem">
                <div class="showcase-icon">üéÅ</div>
                <div class="showcase-name">ÂáÜÂ§áÂºÄÂßã</div>
                <div class="showcase-price">0.00</div>
            </div>
            <div class="showcase-arrows">
                <div class="arrow-left">‚Äπ</div>
                <div class="arrow-right">‚Ä∫</div>
            </div>
        </div>

        <!-- ÊäΩÂ•ñËÆæÁΩÆ -->
        <div class="draw-settings">
            <div class="draw-mode-selector">
                <button class="mode-btn active" data-mode="1">ÂçïÊäΩ</button>
                <button class="mode-btn" data-mode="3">‰∏âËøûÊäΩ</button>
                <button class="mode-btn" data-mode="5">‰∫îËøûÊäΩ</button>
            </div>
            
            <div class="animation-settings">
                <label class="setting-item">
                    <input type="checkbox" id="skipAnimation" class="skip-checkbox">
                    <span class="neon-text">Ë∑≥ËøáÂä®Áîª</span>
                </label>
            </div>
        </div>

        <!-- ÊäΩÂ•ñÊåâÈíÆ -->
        <div class="slot-controls">
            <button id="spinBtn" class="btn-spin">
                <span class="btn-text">ÂºÄÂßãÊäΩÂ•ñ</span>
                <span class="btn-cost" id="btnCost">(Ê∂àËÄó: 10)</span>
            </button>
        </div>

        <!-- Ê®™ÂêëÊªöÂä®ËÄÅËôéÊú∫ -->
        <div class="horizontal-slot-container">
            <div class="slot-rows" id="slotRows">
                <!-- ÊäΩÂ•ñË°åÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>

        <!-- Â•ñÂìÅËØ¥Êòé - Âç°ÁâáÂºèÂ±ïÁ§∫ -->
        <div class="prize-info">
            <h3 class="neon-text gold">üéØ Â•ñÂä±ÂàóË°®</h3>
            <div class="prize-grid" id="prizeGrid">
                <!-- Â•ñÂìÅËØ¥ÊòéÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>
    </div>

    <!-- ÊØèÊó•Á≠æÂà∞ÂºπÁ™ó -->
    <div id="checkinModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="neon-text gold">ÊØèÊó•Á≠æÂà∞</h3>
                <span class="close" onclick="closeCheckinModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="checkinContent">
                    <div class="checkin-calendar">
                        <div class="calendar-header">
                            <h4 class="neon-text">Êú¨ÊúàÁ≠æÂà∞ËÆ∞ÂΩï</h4>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            <!-- Êó•ÂéÜÁΩëÊ†ºÂ∞ÜÈÄöËøáJSÁîüÊàê -->
                        </div>
                    </div>
                    <div class="checkin-rewards">
                        <h4 class="neon-text gold">Á≠æÂà∞Â•ñÂä±</h4>
                        <div class="reward-item">
                            <span>ËøûÁª≠Á≠æÂà∞1Â§©ÔºöÈáëÂ∏Å +10</span>
                        </div>
                        <div class="reward-item">
                            <span>ËøûÁª≠Á≠æÂà∞7Â§©ÔºöÈáëÂ∏Å +100</span>
                        </div>
                        <div class="reward-item">
                            <span>ËøûÁª≠Á≠æÂà∞30Â§©ÔºöÁ•ûÁßòÁ§ºÂìÅ</span>
                        </div>
                    </div>
                    <button id="checkinBtn" class="btn-checkin" onclick="performCheckin()">
                        Á´ãÂç≥Á≠æÂà∞
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰ªìÂ∫ìÂºπÁ™ó -->
    <div id="warehouseModal" class="modal">
        <div class="modal-content warehouse-modal">
            <div class="modal-header">
                <h3 class="neon-text gold">ÊàëÁöÑ‰ªìÂ∫ì</h3>
                <span class="close" onclick="closeWarehouseModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="warehouse-tabs">
                    <button class="tab-btn active" data-tab="items">Áâ©ÂìÅ</button>
                    <button class="tab-btn" data-tab="rewards">Â•ñÂä±</button>
                    <button class="tab-btn" data-tab="gifts">Á§ºÂìÅ</button>
                </div>
                <div class="warehouse-content">
                    <div id="warehouseItems" class="warehouse-grid">
                        <!-- ‰ªìÂ∫ìÁâ©ÂìÅÂ∞ÜÈÄöËøáJSÁîüÊàê -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰∏≠Â•ñÊèêÁ§∫ -->
    <div id="winModal" class="modal">
        <div class="modal-content">
            <h3 class="neon-text gold">ÊÅ≠Âñú‰∏≠Â•ñÔºÅ</h3>
            <div id="winResult" class="win-result"></div>
            <button onclick="closeWinModal()" class="btn-neon">Á°ÆÂÆö</button>
        </div>
    </div>

    <style>
        /* ‰ΩøÁî®Á∫¢Ëâ≤‰∏ªÈ¢òÁöÑËá™ÂÆö‰πâÊ†∑ÂºèË¶ÜÁõñ */
        
        /* ÈôêÊó∂ÊéâËêΩÁ™óÂè£Ê†∑Âºè - ÂΩ©ËôπÈúìËôπÁâπÊïà */
        .limited-drop-window {
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            width: 100%;
            background: linear-gradient(135deg, rgba(15, 15, 25, 0.98), rgba(20, 20, 35, 0.98));
            backdrop-filter: blur(10px);
            border-bottom: 3px solid transparent;
            background-image: 
                linear-gradient(135deg, rgba(15, 15, 25, 0.98), rgba(20, 20, 35, 0.98)),
                linear-gradient(90deg, #ff0080, #ff8c00, #40e0d0, #9370db, #ff0080);
            background-origin: border-box;
            background-clip: padding-box, border-box;
            z-index: 998;
            transform: translateY(-100%);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }
        
        .limited-drop-window.show {
            transform: translateY(0);
        }
        
        .limited-drop-window.collapsed {
            transform: translateY(calc(-100% + 8px));
        }
        
        .limited-drop-window.collapsed:hover {
            transform: translateY(0);
        }
        
        /* Ê∑ªÂä†‰∏Ä‰∏™È°∂ÈÉ®Ëß¶ÂèëÊù° */
        .limited-drop-window::after {
            content: '‚ñº ÈôêÊó∂ÊéâËêΩ ‚ñº';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, #ff0080, #ff8c00, #40e0d0, #9370db);
            color: #fff;
            padding: 2px 20px;
            border-radius: 0 0 8px 8px;
            font-size: 11px;
            font-weight: bold;
            letter-spacing: 1px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            white-space: nowrap;
        }
        
        .limited-drop-window.collapsed::after {
            opacity: 1;
        }
        
        /* ÂΩ©ËôπËæπÊ°ÜÂä®Áîª */
        @keyframes rainbow-border {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .limited-drop-window::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(255, 0, 128, 0.1), 
                rgba(255, 140, 0, 0.1), 
                rgba(64, 224, 208, 0.1), 
                rgba(147, 112, 219, 0.1));
            background-size: 200% 200%;
            animation: rainbow-border 3s ease infinite;
            pointer-events: none;
        }
        
        .limited-drop-header {
            background: linear-gradient(90deg, 
                rgba(255, 0, 128, 0.15), 
                rgba(255, 140, 0, 0.15), 
                rgba(64, 224, 208, 0.15));
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding: 15px 35px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .limited-drop-header h3 {
            margin: 0;
            font-size: 24px;
            background: linear-gradient(90deg, 
                #ff0080, 
                #ff8c00, 
                #40e0d0, 
                #9370db, 
                #ff0080);
            background-size: 200% auto;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbow-text 3s linear infinite;
            font-weight: 700;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
            letter-spacing: 2px;
        }
        
        .limited-drop-hint {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 12px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            white-space: nowrap;
        }
        
        @keyframes rainbow-text {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        
        .close-btn {
            color: #fff;
            opacity: 0.7;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }
        
        .limited-drop-prize .prize-name {
            background: linear-gradient(135deg, #40e0d0, #9370db);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
        }
        
        /* Ê∏∏ÊàèÂÆπÂô® - CS2È£éÊ†ºÊ∑±Ëâ≤ËÉåÊôØ */
        .game-container {
            margin-top: 70px;
            padding: 20px 20px 40px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
            position: relative;
            background: linear-gradient(180deg, 
                rgba(15, 15, 20, 0.95) 0%, 
                rgba(20, 20, 25, 0.98) 50%,
                rgba(15, 15, 20, 0.95) 100%);
        }
        
        /* Ê∑ªÂä†ËÉåÊôØË£ÖÈ•∞ - Á∫¢Ëâ≤Ê∏êÂèòÂÖâÊïà */
        .game-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: 50%;
            transform: translateX(-50%);
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, 
                rgba(239, 68, 68, 0.12) 0%, 
                rgba(220, 38, 38, 0.08) 30%,
                transparent 70%);
            pointer-events: none;
            z-index: 0;
            animation: pulse-glow 8s ease-in-out infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 0.5; transform: translateX(-50%) scale(1); }
            50% { opacity: 0.8; transform: translateX(-50%) scale(1.1); }
        }
        
        /* 3DÂ±ïÁ§∫Âå∫Âüü - CS2È£éÊ†º Á∫¢Ëâ≤‰∏ªÈ¢ò */
        .showcase-area {
            position: relative;
            margin: 30px auto;
            padding: 60px 40px;
            max-width: 600px;
            z-index: 1;
            transition: all 0.5s ease;
        }
        
        .showcase-area.hidden {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) scale(0.8);
        }
        
        .showcase-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, 
                rgba(239, 68, 68, 0.25) 0%, 
                rgba(220, 38, 38, 0.15) 30%,
                transparent 70%);
            filter: blur(40px);
            animation: showcase-pulse 3s ease-in-out infinite;
        }
        
        @keyframes showcase-pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
        }
        
        .showcase-item {
            position: relative;
            z-index: 2;
            padding: 50px 40px;
            background: linear-gradient(135deg, 
                rgba(30, 20, 20, 0.6), 
                rgba(20, 15, 15, 0.8));
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 20px;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 0 40px rgba(239, 68, 68, 0.2);
            transition: all 0.4s ease;
        }
        
        .showcase-item:hover {
            transform: translateY(-10px);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.15),
                0 0 60px rgba(239, 68, 68, 0.4);
        }
        
        .showcase-icon {
            font-size: 100px;
            margin-bottom: 15px;
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.5));
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }
        
        .showcase-name {
            font-size: 22px;
            font-weight: bold;
            color: #4ade80;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
        }
        
        .showcase-price {
            font-size: 28px;
            font-weight: bold;
            color: #4ade80;
            text-shadow: 0 0 20px rgba(74, 222, 128, 0.5);
        }
        
        .showcase-arrows {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            pointer-events: none;
            z-index: 3;
        }
        
        .arrow-left, .arrow-right {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0;
            color: transparent;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.25));
            border: 2px solid rgba(239, 68, 68, 0.4);
            border-radius: 50%;
            cursor: pointer;
            pointer-events: all;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 20px rgba(239, 68, 68, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        /* ÁÆ≠Â§¥ÂÜÖÈÉ®Ë£ÖÈ•∞ */
        .arrow-left::before, .arrow-right::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(239, 68, 68, 0.3) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.4s ease;
        }
        
        /* ÁÆ≠Â§¥ÂõæÊ†á */
        .arrow-left::after, .arrow-right::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            border-top: 3px solid rgba(239, 68, 68, 0.8);
            border-right: 3px solid rgba(239, 68, 68, 0.8);
            transition: all 0.3s ease;
        }
        
        .arrow-left::after {
            transform: rotate(-135deg);
            margin-right: -4px;
        }
        
        .arrow-right::after {
            transform: rotate(45deg);
            margin-left: -4px;
        }
        
        /* Â§ñÂúàË£ÖÈ•∞ÁéØ */
        .arrow-left, .arrow-right {
            box-shadow: 
                0 0 0 0 rgba(239, 68, 68, 0.4),
                0 4px 20px rgba(239, 68, 68, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse-ring {
            0%, 100% {
                box-shadow: 
                    0 0 0 0 rgba(239, 68, 68, 0.4),
                    0 4px 20px rgba(239, 68, 68, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1),
                    inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            }
            50% {
                box-shadow: 
                    0 0 0 8px rgba(239, 68, 68, 0),
                    0 4px 20px rgba(239, 68, 68, 0.3),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1),
                    inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            }
        }
        
        .arrow-left:hover, .arrow-right:hover {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.4));
            border-color: rgba(239, 68, 68, 0.8);
            transform: scale(1.1);
            box-shadow: 
                0 0 0 0 rgba(239, 68, 68, 0),
                0 8px 30px rgba(239, 68, 68, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                inset 0 -1px 0 rgba(0, 0, 0, 0.3);
            animation: none;
        }
        
        .arrow-left:hover::before, .arrow-right:hover::before {
            opacity: 1;
        }
        
        .arrow-left:hover::after, .arrow-right:hover::after {
            border-color: rgba(239, 68, 68, 1);
            filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.8));
        }
        
        .arrow-left:active, .arrow-right:active {
            transform: scale(0.95);
            box-shadow: 
                0 0 0 0 rgba(239, 68, 68, 0),
                0 2px 10px rgba(239, 68, 68, 0.4),
                inset 0 2px 4px rgba(0, 0, 0, 0.4);
        }
        
        /* Ê∑ªÂä†Èó™ÂÖâÊïàÊûú */
        .arrow-left:hover, .arrow-right:hover {
            animation: shine 1.5s ease-in-out infinite;
        }
        
        @keyframes shine {
            0%, 100% {
                filter: brightness(1);
            }
            50% {
                filter: brightness(1.2);
            }
        }
        
        .game-header {
            margin-bottom: 40px;
        }
        
        .game-header h2 {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .game-header p {
            font-size: 18px;
            opacity: 0.8;
        }

        /* ÊäΩÂ•ñËÆæÁΩÆÊ†∑Âºè - Á∫¢Ëâ≤‰∏ªÈ¢ò */
        .draw-settings {
            margin: 30px 0;
        }
        
        .draw-mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .mode-btn {
            padding: 10px 25px;
            border: 2px solid #ef4444;
            background: transparent;
            color: #4ade80;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 600;
        }
        
        .mode-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .mode-btn.active {
            background: #ef4444;
            color: #fff;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }

        .animation-settings {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        
        .setting-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        
        .setting-item:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .skip-checkbox {
            width: 18px;
            height: 18px;
            accent-color: #ef4444;
            cursor: pointer;
        }
        
        .skip-checkbox:checked + .neon-text {
            color: #ef4444;
            text-shadow: 0 0 10px #ef4444;
        }

        /* Ê®™ÂêëÊªöÂä®ËÄÅËôéÊú∫Ê†∑Âºè - Á∫¢Ëâ≤‰∏ªÈ¢ò + CS2È£éÊ†º */
        .horizontal-slot-container {
            margin: 0;
            padding: 0 10px;
            position: relative;
            z-index: 1;
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        
        .horizontal-slot-container.active {
            opacity: 1;
            max-height: 1000px;
            margin: 30px 0;
        }
        
        .slot-rows {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .slot-row {
            position: relative;
            height: 100px;
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: 12px;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(20, 20, 40, 0.8));
            width: 100%;
            min-width: 320px;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .slot-strip {
            display: flex;
            height: 100%;
            transform: translateX(0px);
            transition: none;
            will-change: transform;
            min-width: 100%;
        }
        
        .slot-item {
            flex: 0 0 100px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid rgba(239, 68, 68, 0.15);
            background: linear-gradient(180deg, rgba(239, 68, 68, 0.05), rgba(239, 68, 68, 0.02));
            min-width: 100px;
            transition: all 0.2s ease;
        }
        
        .slot-item:hover {
            background: linear-gradient(180deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
        }
        
        .slot-item:last-child {
            border-right: none;
        }
        
        .slot-item .icon {
            font-size: 32px;
            margin-bottom: 8px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }
        
        .slot-item .name {
            font-size: 11px;
            color: #4ade80;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            padding: 0 4px;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }
        
        /* ‰∏≠ÂøÉÊåáÈíà - Á∫¢Ëâ≤ + Â¢ûÂº∫ÊïàÊûú */
        .slot-pointer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 3px;
            height: 80px;
            background: linear-gradient(to bottom, #ef4444, #dc2626, #ef4444);
            border-radius: 2px;
            box-shadow: 
                0 0 10px #ef4444,
                0 0 20px rgba(239, 68, 68, 0.5),
                0 0 30px rgba(239, 68, 68, 0.3);
            z-index: 10;
            animation: pointer-glow 2s ease-in-out infinite alternate;
        }
        
        .slot-pointer::before {
            content: '';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 12px solid #ef4444;
            filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.8));
        }
        
        .slot-pointer::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 12px solid #ef4444;
            filter: drop-shadow(0 0 8px rgba(239, 68, 68, 0.8));
        }
        
        @keyframes pointer-glow {
            0% { 
                box-shadow: 
                    0 0 10px #ef4444,
                    0 0 20px rgba(239, 68, 68, 0.5),
                    0 0 30px rgba(239, 68, 68, 0.3);
            }
            100% { 
                box-shadow: 
                    0 0 20px #ef4444,
                    0 0 40px rgba(239, 68, 68, 0.8),
                    0 0 60px rgba(239, 68, 68, 0.5);
            }
        }
        
        .slot-machine-container {
            margin: 40px 0;
        }
        
        /* ÊäΩÂ•ñÊåâÈíÆ - CS2È£éÊ†º Á∫¢Ëâ≤‰∏ªÈ¢ò */
        .slot-controls {
            margin: 20px 0 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1;
            position: relative;
        }
        
        .btn-spin {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: 2px solid rgba(239, 68, 68, 0.5);
            padding: 16px 50px;
            border-radius: 50px;
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 
                0 8px 25px rgba(239, 68, 68, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-spin::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: left 0.5s ease;
        }
        
        .btn-spin:hover::before {
            left: 100%;
        }
        
        .btn-spin:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 12px 35px rgba(239, 68, 68, 0.6),
                0 0 40px rgba(239, 68, 68, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border-color: rgba(239, 68, 68, 0.8);
        }
        
        .btn-spin:active {
            transform: translateY(-1px) scale(1.02);
        }
        
        .btn-spin:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: linear-gradient(135deg, #6b7280, #4b5563);
            border-color: rgba(107, 114, 128, 0.5);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-text {
            position: relative;
            z-index: 1;
        }
        
        .btn-cost {
            display: block;
            font-size: 12px;
            opacity: 0.9;
            margin-top: 3px;
            font-weight: 600;
        }
        
        /* Â•ñÂìÅÂå∫Âüü - CS2Âç°ÁâáÈ£éÊ†º */
        .prize-info {
            margin-top: 80px;
            padding: 50px 30px;
            position: relative;
            z-index: 1;
        }
        
        .prize-info h3 {
            font-size: 28px;
            margin-bottom: 40px;
            text-shadow: 0 2px 10px rgba(74, 222, 128, 0.3);
            letter-spacing: 1px;
        }
        
        .prize-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* CS2È£éÊ†ºÂç°Áâá - Á∫¢Ëâ≤‰∏ªÈ¢ò */
        .prize-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 15px;
            background: linear-gradient(135deg, 
                rgba(30, 20, 20, 0.7), 
                rgba(20, 15, 15, 0.9));
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            box-shadow: 
                0 4px 15px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        /* È°∂ÈÉ®Ê∏êÂèòÊù° - Á∫¢Ëâ≤ */
        .prize-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(239, 68, 68, 0.8), 
                transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        /* ÊÇ¨ÊµÆÂÖâÊïà - Á∫¢Ëâ≤ */
        .prize-item::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 0;
            height: 0;
            background: radial-gradient(circle, 
                rgba(239, 68, 68, 0.3) 0%, 
                transparent 70%);
            border-radius: 50%;
            transition: all 0.4s ease;
        }
        
        .prize-item:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(239, 68, 68, 0.5);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.6),
                0 0 30px rgba(239, 68, 68, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            background: linear-gradient(135deg, 
                rgba(40, 25, 25, 0.8), 
                rgba(30, 20, 20, 0.95));
        }
        
        .prize-item:hover::before {
            opacity: 1;
        }
        
        .prize-item:hover::after {
            width: 200px;
            height: 200px;
        }
        
        .prize-icon {
            font-size: 48px;
            margin-bottom: 15px;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.4));
            transition: all 0.3s ease;
            z-index: 1;
        }
        
        .prize-item:hover .prize-icon {
            transform: scale(1.1) translateY(-5px);
            filter: drop-shadow(0 8px 20px rgba(239, 68, 68, 0.4));
        }
        
        .prize-name {
            color: #4ade80;
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 14px;
            text-shadow: 0 0 8px rgba(74, 222, 128, 0.5);
            z-index: 1;
            text-align: center;
            line-height: 1.3;
        }
        
        .prize-value {
            color: #4ade80;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
            z-index: 1;
        }
        
        /* Á®ÄÊúâÂ∫¶Ê†áÁ≠æ */
        .prize-item .prize-rarity {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ef4444;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .warehouse-modal {
            max-width: 600px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            font-size: 30px;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .close:hover {
            color: #ef4444;
        }

        /* Á≠æÂà∞ÂºπÁ™óÊ†∑Âºè */
        .checkin-calendar {
            margin: 20px 0;
        }

        .calendar-header {
            margin-bottom: 15px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .calendar-day {
            padding: 8px;
            border: 1px solid #444;
            border-radius: 5px;
            font-size: 12px;
            text-align: center;
        }

        .calendar-day.checked {
            background: #4ade80;
            color: #000;
        }

        .calendar-day.today {
            border-color: #ef4444;
            border-width: 2px;
        }

        .checkin-rewards {
            margin: 20px 0;
            text-align: left;
        }

        .reward-item {
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }

        .btn-checkin {
            background: linear-gradient(45deg, #4ade80, #22c55e);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-checkin:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 222, 128, 0.4);
        }

        .btn-checkin:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* ‰ªìÂ∫ìÂºπÁ™óÊ†∑Âºè */
        .warehouse-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab-btn {
            padding: 8px 20px;
            border: 2px solid #444;
            background: transparent;
            color: #fff;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            border-color: #ef4444;
            color: #ef4444;
        }

        .warehouse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .warehouse-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #444;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .warehouse-item:hover {
            border-color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.2);
        }

        .warehouse-item-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .warehouse-item-name {
            font-size: 12px;
            color: #4ade80;
            margin-bottom: 5px;
        }

        .warehouse-item-count {
            font-size: 10px;
            opacity: 0.7;
        }
        
        .modal-content h3 {
            font-size: 28px;
            margin-bottom: 20px;
        }
        
        .win-result {
            margin: 30px 0;
            font-size: 48px;
        }
        
        .prize-image {
            width: 40px;
            height: 40px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 5px;
        }
        
        .slot-item-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        
        .slot-item .prize-name {
            font-size: 10px;
            color: #4ade80;
            text-align: center;
            margin-top: 5px;
        }
        
        .slot-item.active {
            background: rgba(239, 68, 68, 0.3);
            border: 2px solid #ef4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }
        
        .prize-item .prize-display {
            margin-bottom: 15px;
        }
        
        .prize-item .prize-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 10px;
        }
        
        .prize-item .prize-rarity {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.7);
        }
        
        .prize-item.common .prize-rarity {
            color: #9ca3af;
        }
        
        .prize-item.rare .prize-rarity {
            color: #3b82f6;
        }
        
        .prize-item.epic .prize-rarity {
            color: #8b5cf6;
        }
        
        .prize-item.legendary .prize-rarity {
            color: #f59e0b;
        }
        
        @keyframes spin {
            0% { transform: translateY(0); }
            100% { transform: translateY(-400%); }
        }
        
        @media (max-width: 768px) {
            .navbar {
                padding: 0 15px;
                height: 60px;
                backdrop-filter: blur(15px);
            }
            
            .nav-brand h1 {
                font-size: 18px;
            }
            
            .nav-user {
                gap: 10px;
            }
            
            .nav-item {
                padding: 6px 12px;
                border-radius: 12px;
                min-width: auto;
            }
            
            .nav-item .icon {
                font-size: 16px;
            }
            
            .nav-item span {
                font-size: 10px;
            }
            
            .user-info {
                gap: 8px;
                padding: 6px 12px;
                border-radius: 20px;
            }
            
            .user-avatar {
                width: 32px;
                height: 32px;
            }
            
            .game-container {
                padding: 20px 15px;
                margin-top: 60px;
            }
            
            .game-header h2 {
                font-size: 32px;
                margin-bottom: 12px;
            }
            
            .game-header p {
                font-size: 16px;
            }
            
            .draw-settings {
                flex-direction: column;
                gap: 15px;
                padding: 15px 5px;
            }
            
            .draw-mode-selector {
                gap: 10px;
            }
            
            .mode-btn {
                padding: 8px 16px;
                font-size: 14px;
            }
            
            .horizontal-slot-container {
                padding: 10px 5px;
                margin: 20px 0;
            }
            
            .slot-rows {
                gap: 8px;
            }
            
            .slot-row {
                height: 70px;
                min-width: 300px;
                margin: 0 auto;
                max-width: 95vw;
                border-radius: 10px;
            }
            
            .slot-strip {
                min-width: 600px; /* Á°Æ‰øùË∂≥Â§üÁöÑÂÆΩÂ∫¶Êù•ÂÆπÁ∫≥ÊâÄÊúâÂ•ñÂìÅ */
            }
            
            .slot-item {
                flex: 0 0 50px;
                height: 70px;
                min-width: 50px;
                max-width: 50px;
            }
            
            .slot-item .icon {
                font-size: 20px;
                margin-bottom: 4px;
            }
            
            .slot-item .name {
                font-size: 9px;
                line-height: 1.1;
                padding: 0 2px;
            }
            
            .slot-pointer {
                width: 3px;
                height: 55px;
            }
            
            .slot-pointer::before,
            .slot-pointer::after {
                border-left-width: 6px;
                border-right-width: 6px;
                border-bottom-width: 8px;
                border-top-width: 8px;
            }
            
            .slot-controls {
                margin-top: 15px;
            }
            
            .btn-spin {
                padding: 12px 30px;
                font-size: 16px;
            }
            
            .prize-info {
                padding: 15px;
            }
            
            .prize-info h3 {
                font-size: 20px;
            }
            
            .prize-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .prize-item {
                padding: 12px;
            }
            
            .prize-name {
                font-size: 14px;
            }
            
            .prize-value {
                font-size: 12px;
            }
            
            .modal-content {
                max-width: 90vw;
                padding: 20px;
                margin: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .navbar {
                padding: 0 10px;
            }
            
            .nav-brand h1 {
                font-size: 16px;
            }
            
            .nav-user {
                gap: 8px;
            }
            
            .nav-item {
                padding: 4px 8px;
            }
            
            .nav-item span {
                display: none;
            }
            
            .user-info {
                padding: 4px 8px;
            }
            
            .game-container {
                padding: 15px 10px;
            }
            
            .game-header h2 {
                font-size: 28px;
            }
            
            .draw-settings {
                padding: 10px 3px;
            }
            
            .mode-btn {
                padding: 6px 12px;
                font-size: 13px;
            }
            
            .horizontal-slot-container {
                padding: 8px 3px;
            }
            
            .slot-rows {
                gap: 6px;
            }
            
            .slot-row {
                height: 40px;
                min-width: 280px;
                max-width: 92vw;
                margin: 0 auto;
                border-radius: 6px;
            }
            
            .slot-strip {
                min-width: 500px; /* Á°Æ‰øùË∂≥Â§üÁöÑÂÆΩÂ∫¶Êù•ÂÆπÁ∫≥ÊâÄÊúâÂ•ñÂìÅ */
            }
            
            .slot-item {
                flex: 0 0 40px;
                height: 40px;
                min-width: 40px;
                max-width: 40px;
            }
            
            .slot-item .icon {
                font-size: 14px;
                margin-bottom: 1px;
            }
            
            .slot-item .name {
                font-size: 7px;
                line-height: 1;
                padding: 0;
            }
            
            .slot-pointer {
                width: 2px;
                height: 30px;
            }
            
            .slot-pointer::before,
            .slot-pointer::after {
                border-left-width: 4px;
                border-right-width: 4px;
                border-bottom-width: 6px;
                border-top-width: 6px;
            }
            
            .btn-spin {
                padding: 10px 25px;
                font-size: 15px;
            }
            
            .prize-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .prize-item {
                padding: 10px;
            }
        }
    </style>

    <script src="../js/api-client.js"></script>
    <script src="../js/effects.js"></script>
    <script>
        let currentUser = null;
        let prizeData = [];
        let currentMode = 1; // ÂΩìÂâçÊäΩÂ•ñÊ®°ÂºèÔºö1ÂçïÊäΩÔºå3‰∏âËøûÊäΩÔºå5‰∫îËøûÊäΩ
        let drawPrices = { single: 10, triple: 30, quintuple: 50 }; // Âä®ÊÄÅ‰ª∑Ê†º

        // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅÂπ∂Âä†ËΩΩÊï∞ÊçÆ
        async function initPage() {
            // Áõ¥Êé•Ê£ÄÊü•localStorage‰∏≠ÁöÑÁôªÂΩïÁä∂ÊÄÅ
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const currentUserData = localStorage.getItem('currentUser');
            
            if (isLoggedIn !== 'true' || !currentUserData) {
                alert('ËØ∑ÂÖàÁôªÂΩïÔºÅ');
                window.location.href = 'auth/login.html';
                return;
            }
            
            try {
                currentUser = JSON.parse(currentUserData);
                console.log('ÂΩìÂâçÁî®Êà∑:', currentUser);
            } catch (e) {
                alert('Áî®Êà∑‰ø°ÊÅØÂºÇÂ∏∏ÔºåËØ∑ÈáçÊñ∞ÁôªÂΩïÔºÅ');
                window.location.href = 'auth/login.html';
                return;
            }
            
            await loadUserInfo();
            await loadPrizes();
            await loadDrawPrices(); // Âä†ËΩΩÊäΩÂ•ñ‰ª∑Ê†º
            await initLimitedDrop(); // ÂàùÂßãÂåñÈôêÊó∂ÊéâËêΩ
            initSlotMachine();
            bindEvents();
            createParticles();
        }

        // Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ
        async function loadUserInfo() {
            try {
                const result = await api.getUserProfile();
                if (result.success) {
                    const user = result.user;
                    document.getElementById('userAvatar').src = user.avatar;
                    document.getElementById('userNickname').textContent = user.nickname;
                    document.getElementById('userBalance').textContent = `‰ΩôÈ¢ù: ${user.balance}`;
                }
            } catch (error) {
                console.error('Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•:', error);
            }
        }

        // Âä†ËΩΩÂ•ñÂìÅÊï∞ÊçÆ
        async function loadPrizes() {
            try {
                // ‰ªéURL‰∏≠Ëé∑ÂèñÂΩìÂâçÈ°µÈù¢ÂèÇÊï∞ÔºåÊàñËÄÖÊ†πÊçÆÊñá‰ª∂ÂêçÁ°ÆÂÆöÈ°µÈù¢
                const urlParams = new URLSearchParams(window.location.search);
                let currentPage = urlParams.get('page');
                
                // Â¶ÇÊûúURL‰∏≠Ê≤°ÊúâpageÂèÇÊï∞ÔºåÂ∞ùËØï‰ªéÊñá‰ª∂ÂêçÊé®Êñ≠
                if (!currentPage) {
                    const path = window.location.pathname;
                    const filename = path.substring(path.lastIndexOf('/') + 1);
                    currentPage = filename;
                }
                
                // Â¶ÇÊûúËøòÊòØÊ≤°ÊúâÔºåÈªòËÆ§‰ΩøÁî®lucky1.html
                if (!currentPage || currentPage === 'luckytemp.html') {
                    currentPage = 'lucky1.html';
                }
                
                console.log('ÂΩìÂâçÈ°µÈù¢:', currentPage);
                
                // ‰ΩøÁî®‰øÆÊîπÂêéÁöÑAPIË∞ÉÁî®Ôºå‰º†ÂÖ•È°µÈù¢ÂèÇÊï∞
                const result = await api.getPrizes('lucky_drop', currentPage);
                if (result.success) {
                    prizeData = result.prizes;
                    console.log('Âä†ËΩΩÁöÑÂ•ñÂìÅÊï∞ÊçÆ:', prizeData);
                }
            } catch (error) {
                console.error('Âä†ËΩΩÂ•ñÂìÅÊï∞ÊçÆÂ§±Ë¥•:', error);
                // ‰ΩøÁî®ÈªòËÆ§Êï∞ÊçÆ
                prizeData = [
                    { id: 1, name: 'iPhone 15 Pro', icon: 'üì±', image_url: '/uploads/prizes/iphone15.jpg', value: 8000, rarity: 'legendary', probability: 1 },
                    { id: 2, name: 'MacBook Air', icon: 'üíª', image_url: '/uploads/prizes/macbook.jpg', value: 7000, rarity: 'legendary', probability: 1 },
                    { id: 3, name: 'AirPods Pro', icon: 'üéß', image_url: '/uploads/prizes/airpods.jpg', value: 1500, rarity: 'epic', probability: 5 },
                    { id: 4, name: 'iPad', icon: 'üì±', image_url: '/uploads/prizes/ipad.jpg', value: 3000, rarity: 'epic', probability: 3 },
                    { id: 5, name: 'Apple Watch', icon: '‚åö', image_url: '/uploads/prizes/watch.jpg', value: 2500, rarity: 'rare', probability: 8 },
                    { id: 6, name: 'ËìùÁâôÈü≥Âìç', icon: 'üîä', image_url: '/uploads/prizes/speaker.jpg', value: 500, rarity: 'rare', probability: 15 },
                    { id: 7, name: 'ÂÖÖÁîµÂÆù', icon: 'üîã', image_url: '/uploads/prizes/powerbank.jpg', value: 100, rarity: 'common', probability: 30 },
                    { id: 8, name: 'Êï∞ÊçÆÁ∫ø', icon: 'üîå', image_url: '/uploads/prizes/cable.jpg', value: 50, rarity: 'common', probability: 37 }
                ];
            }
            
            generatePrizeGrid();
        }

        // Âä†ËΩΩÊäΩÂ•ñ‰ª∑Ê†º
        async function loadDrawPrices() {
            try {
                // Ëé∑ÂèñÂΩìÂâçÈ°µÈù¢ÂèÇÊï∞
                const urlParams = new URLSearchParams(window.location.search);
                let currentPage = urlParams.get('page');
                
                if (!currentPage) {
                    const path = window.location.pathname;
                    const filename = path.substring(path.lastIndexOf('/') + 1);
                    currentPage = filename;
                }
                
                if (!currentPage || currentPage === 'luckytemp.html') {
                    currentPage = 'lucky1.html';
                }
                
                const response = await fetch(`../../server/api/admin.php?action=get_draw_prices&page=${encodeURIComponent(currentPage)}`);
                const data = await response.json();
                
                if (data.success) {
                    drawPrices = data.prices;
                    console.log('Âä†ËΩΩÁöÑÊäΩÂ•ñ‰ª∑Ê†º:', drawPrices);
                    
                    // Êõ¥Êñ∞ÊåâÈíÆÂêçÁß∞
                    if (data.names) {
                        const singleBtn = document.querySelector('.mode-btn[data-mode="1"]');
                        const tripleBtn = document.querySelector('.mode-btn[data-mode="3"]');
                        const quintupleBtn = document.querySelector('.mode-btn[data-mode="5"]');
                        
                        if (singleBtn && data.names.single) {
                            singleBtn.textContent = data.names.single;
                        }
                        if (tripleBtn && data.names.triple) {
                            tripleBtn.textContent = data.names.triple;
                        }
                        if (quintupleBtn && data.names.quintuple) {
                            quintupleBtn.textContent = data.names.quintuple;
                        }
                    }
                } else {
                    console.warn('Âä†ËΩΩ‰ª∑Ê†ºÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§‰ª∑Ê†º:', data.error);
                }
            } catch (error) {
                console.error('Âä†ËΩΩÊäΩÂ•ñ‰ª∑Ê†ºÂ§±Ë¥•:', error);
            }
        }

        // ÂàùÂßãÂåñÊ®™ÂêëÊªöÂä®ËÄÅËôéÊú∫
        function initSlotMachine() {
            updateSlotRows();
        }

        // Êõ¥Êñ∞ËÄÅËôéÊú∫Ë°åÊï∞
        function updateSlotRows() {
            const slotRows = document.getElementById('slotRows');
            slotRows.innerHTML = '';
            
            for (let i = 0; i < currentMode; i++) {
                const row = createSlotRow();
                slotRows.appendChild(row);
            }
            
            // Êõ¥Êñ∞ÊåâÈíÆÊòæÁ§∫ÁöÑÊ∂àËÄó - ‰ΩøÁî®Âä®ÊÄÅ‰ª∑Ê†º
            let cost;
            if (currentMode === 1) {
                cost = drawPrices.single;
            } else if (currentMode === 3) {
                cost = drawPrices.triple;
            } else if (currentMode === 5) {
                cost = drawPrices.quintuple;
            } else {
                cost = currentMode * drawPrices.single; // Â§áÁî®ËÆ°ÁÆóÊñπÂºè
            }
            
            document.getElementById('btnCost').textContent = `(Ê∂àËÄó: ${cost})`;
        }

        // ÂàõÂª∫‰∏ÄË°åËÄÅËôéÊú∫
        function createSlotRow() {
            const row = document.createElement('div');
            row.className = 'slot-row';
            
            // ÂàõÂª∫ÊªöÂä®Êù°
            const strip = document.createElement('div');
            strip.className = 'slot-strip';
            
            // ÂàõÂª∫‰∏≠ÂøÉÊåáÈíà
            const pointer = document.createElement('div');
            pointer.className = 'slot-pointer';
            
            // ËÆ°ÁÆóÈúÄË¶ÅÁöÑÈáçÂ§çÊ¨°Êï∞ÔºåÁ°Æ‰øùÂú®ÂêÑÁßçÂ±èÂπïÂ∞∫ÂØ∏‰∏ãÈÉΩÊúâË∂≥Â§üÁöÑÂ•ñÂìÅ
            const isMobile = window.innerWidth <= 768;
            const isSmallMobile = window.innerWidth <= 480;
            const itemWidth = isSmallMobile ? 40 : (isMobile ? 50 : 100);
            const containerWidth = Math.max(window.innerWidth * 0.9, 300);
            const visibleItems = Math.ceil(containerWidth / itemWidth);
            
            // Á°Æ‰øùÊúâË∂≥Â§üÁöÑÈ°πÁõÆËÆ©ÊªöÂä®ÁúãËµ∑Êù•ÁúüÂÆûÔºåÂπ∂‰∏îÊ∞∏Ëøú‰∏ç‰ºöÂá∫Áé∞Á©∫ÁôΩ
            const repeatTimes = Math.max(15, visibleItems * 3); // Ëá≥Â∞ëÈáçÂ§ç15Ê¨°Êàñ3ÂÄçÂèØËßÅÈ°πÁõÆÊï∞
            
            for (let repeat = 0; repeat < repeatTimes; repeat++) {
                for (let i = 0; i < prizeData.length; i++) {
                    const prize = prizeData[i];
                    const item = createSlotItem(prize);
                    strip.appendChild(item);
                }
            }
            
            row.appendChild(strip);
            row.appendChild(pointer);
            
            return row;
        }

        // ÂàõÂª∫ËÄÅËôéÊú∫È°πÁõÆ
        function createSlotItem(prize) {
            const item = document.createElement('div');
            item.className = 'slot-item';
            item.dataset.prizeId = prize.id;
            
            // Ê†πÊçÆÂ±èÂπïÂ∞∫ÂØ∏ËÆæÁΩÆitemÂÆΩÂ∫¶
            const isMobile = window.innerWidth <= 768;
            const isSmallMobile = window.innerWidth <= 480;
            const itemWidth = isSmallMobile ? 40 : (isMobile ? 50 : 100);
            item.style.flex = `0 0 ${itemWidth}px`;
            item.style.minWidth = `${itemWidth}px`;
            item.style.maxWidth = `${itemWidth}px`;
            
            const icon = document.createElement('div');
            icon.className = 'icon';
            
            if (prize.image_url) {
                const img = document.createElement('img');
                img.src = prize.image_url;
                img.alt = prize.name;
                
                // Ê†πÊçÆÂ±èÂπïÂ∞∫ÂØ∏Ë∞ÉÊï¥ÂõæÁâáÂ§ßÂ∞è
                const imgSize = isSmallMobile ? '14px' : (isMobile ? '16px' : '32px');
                img.style.width = imgSize;
                img.style.height = imgSize;
                img.style.objectFit = 'cover';
                img.style.borderRadius = '4px';
                img.onerror = () => {
                    img.style.display = 'none';
                    icon.textContent = prize.icon;
                };
                icon.appendChild(img);
            } else {
                icon.textContent = prize.icon;
            }
            
            const name = document.createElement('div');
            name.className = 'name';
            name.textContent = prize.name;
            
            item.appendChild(icon);
            item.appendChild(name);
            
            return item;
        }

        // ÁªëÂÆö‰∫ã‰ª∂
        function bindEvents() {
            // Ê®°ÂºèÈÄâÊã©ÊåâÈíÆ
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    // ÁßªÈô§ÊâÄÊúâÊ¥ªÂä®Áä∂ÊÄÅ
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    // Ê∑ªÂä†Ê¥ªÂä®Áä∂ÊÄÅ
                    e.target.classList.add('active');
                    // ËÆæÁΩÆÂΩìÂâçÊ®°Âºè
                    currentMode = parseInt(e.target.dataset.mode);
                    updateSlotRows();
                });
            });

            // ÊäΩÂ•ñÊåâÈíÆ
            document.getElementById('spinBtn').addEventListener('click', startSpin);
            
            // Ë∑≥ËøáÂä®ÁîªÂ§çÈÄâÊ°Ü - ‰øùÂ≠òÁî®Êà∑ÂÅèÂ•Ω
            const skipCheckbox = document.getElementById('skipAnimation');
            const savedSkipSetting = localStorage.getItem('skipAnimation');
            if (savedSkipSetting === 'true') {
                skipCheckbox.checked = true;
            }
            
            skipCheckbox.addEventListener('change', (e) => {
                localStorage.setItem('skipAnimation', e.target.checked);
            });
        }

        // ÂºÄÂßãÊäΩÂ•ñ
        async function startSpin() {
            const spinBtn = document.getElementById('spinBtn');
            const skipAnimation = document.getElementById('skipAnimation').checked;
            const showcaseArea = document.querySelector('.showcase-area');
            const slotContainer = document.querySelector('.horizontal-slot-container');
            
            spinBtn.disabled = true;
            spinBtn.querySelector('.btn-text').textContent = 'ÊäΩÂ•ñ‰∏≠...';
            
            // ÈöêËóèÂ±ïÁ§∫Âå∫ÔºåÊòæÁ§∫ÊäΩÂ•ñÂä®Áîª
            showcaseArea.classList.add('hidden');
            slotContainer.classList.add('active');

            try {
                // Ê£ÄÊü•Áî®Êà∑‰ø°ÊÅØ
                if (!currentUser || !currentUser.id) {
                    throw new Error('Áî®Êà∑‰ø°ÊÅØÊó†ÊïàÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï');
                }
                
                // Ëé∑ÂèñÂΩìÂâçÈ°µÈù¢ÂèÇÊï∞
                const urlParams = new URLSearchParams(window.location.search);
                let currentPage = urlParams.get('page');
                
                // Â¶ÇÊûúURL‰∏≠Ê≤°ÊúâpageÂèÇÊï∞ÔºåÂ∞ùËØï‰ªéÊñá‰ª∂ÂêçÊé®Êñ≠
                if (!currentPage) {
                    const path = window.location.pathname;
                    const filename = path.substring(path.lastIndexOf('/') + 1);
                    currentPage = filename;
                }
                
                // Â¶ÇÊûúËøòÊòØÊ≤°ÊúâÔºåÈªòËÆ§‰ΩøÁî®lucky1.html
                if (!currentPage || currentPage === 'luckytemp.html') {
                    currentPage = 'lucky1.html';
                }
                
                // Ë∞ÉÁî®ÂêéÁ´ØÊäΩÂ•ñAPIÔºå‰º†ÈÄíÈ°µÈù¢ÂèÇÊï∞
                const drawResult = await api.drawPrizes('lucky_drop', currentMode, currentPage);
                
                if (!drawResult.success) {
                    throw new Error(drawResult.message || drawResult.error || 'ÊäΩÂ•ñÂ§±Ë¥•');
                }
                
                // ÊâßË°åÂä®ÁîªÊàñË∑≥Ëøá
                if (skipAnimation) {
                    // Áõ¥Êé•ÊòæÁ§∫ÁªìÊûúÔºåË∑≥ËøáÂä®Áîª
                    showWinResult(drawResult.prizes || drawResult.results, drawResult.total_value);
                    finishSpin(spinBtn, showcaseArea, slotContainer);
                } else {
                    // Êí≠ÊîæÊªöÂä®Âä®ÁîªÔºå‰ΩøÁî®ÂêéÁ´ØËøîÂõûÁöÑÁªìÊûú
                    await performSpinWithResults(drawResult.prizes || drawResult.results);
                    
                    // ÊòæÁ§∫ÁªìÊûú
                    setTimeout(() => {
                        showWinResult(drawResult.prizes || drawResult.results, drawResult.total_value);
                        finishSpin(spinBtn, showcaseArea, slotContainer);
                    }, 4000);
                }
                
            } catch (error) {
                console.error('ÊäΩÂ•ñÂ§±Ë¥•:', error);
                alert(error.message || 'ÊäΩÂ•ñÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÂÜçËØïÔºÅ');
                
                finishSpin(spinBtn, showcaseArea, slotContainer);
            }
        }
        
        // ÂÆåÊàêÊäΩÂ•ñÁöÑÊ∏ÖÁêÜÂ∑•‰Ωú
        function finishSpin(spinBtn, showcaseArea, slotContainer) {
            // ÈáçÁΩÆÊåâÈíÆ
            spinBtn.disabled = false;
            spinBtn.querySelector('.btn-text').textContent = 'ÂºÄÂßãÊäΩÂ•ñ';
            
            // ÊòæÁ§∫Â±ïÁ§∫Âå∫ÔºåÈöêËóèÊäΩÂ•ñÂä®Áîª
            setTimeout(() => {
                showcaseArea.classList.remove('hidden');
                slotContainer.classList.remove('active');
            }, 2000);
            
            // Êõ¥Êñ∞Áî®Êà∑‰ø°ÊÅØ
            loadUserInfo();
            
            // ÈáçÁΩÆÊâÄÊúâstripÂà∞ÂàùÂßã‰ΩçÁΩÆÔºå‰∏∫‰∏ãÊ¨°ÊäΩÂ•ñÂÅöÂáÜÂ§á
            setTimeout(() => {
                const allStrips = document.querySelectorAll('.slot-strip');
                allStrips.forEach(strip => {
                    strip.style.transition = 'none';
                    strip.style.transform = 'translateX(0px)';
                });
            }, 3000); // Á≠âÂæÖ3ÁßíÂêéÈáçÁΩÆ
        }

        // ‰ΩøÁî®ÂêéÁ´ØÁªìÊûúÊâßË°åÊäΩÂ•ñÂä®Áîª
        async function performSpinWithResults(prizes) {
            const rows = document.querySelectorAll('.slot-row');
            
            // Ê≠£Â∏∏Âä®ÁîªÊµÅÁ®ã
            for (let i = 0; i < rows.length && i < prizes.length; i++) {
                const row = rows[i];
                const strip = row.querySelector('.slot-strip');
                const items = strip.querySelectorAll('.slot-item');
                const winningPrize = prizes[i];
                
                // Âº∫Âà∂ÈáçÁΩÆÂà∞ÂàùÂßã‰ΩçÁΩÆ
                strip.style.transition = 'none';
                strip.style.transform = 'translateX(0px)';
                
                // Âº∫Âà∂ÈáçÁªò
                strip.offsetHeight;
                
                // ÊâæÂà∞ÁõÆÊ†áÂ•ñÂìÅÁöÑÁ¥¢Âºï - ‰ΩøÁî®ÂêçÁß∞ÂíåÁ®ÄÊúâÂ∫¶ÂåπÈÖç
                let targetIndex = -1;
                for (let j = 0; j < items.length; j++) {
                    const itemName = items[j].querySelector('.name')?.textContent;
                    if (itemName === winningPrize.name) {
                        targetIndex = j;
                        break;
                    }
                }
                
                // Â¶ÇÊûúÊâæ‰∏çÂà∞ÂÆåÂÖ®ÂåπÈÖçÁöÑÔºåÂØªÊâæÁõ∏ÂêåÁ®ÄÊúâÂ∫¶ÁöÑÂ•ñÂìÅ
                if (targetIndex === -1) {
                    for (let j = 0; j < items.length; j++) {
                        const itemId = parseInt(items[j].dataset.prizeId);
                        const matchingPrize = prizeData.find(p => p.id === itemId);
                        if (matchingPrize && matchingPrize.rarity === winningPrize.rarity) {
                            targetIndex = j;
                            break;
                        }
                    }
                }
                
                // ÊúÄÂêéÂ§áÁî®ÊñπÊ°àÔºöÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™‰ΩçÁΩÆ
                if (targetIndex === -1) {
                    targetIndex = Math.floor(Math.random() * Math.min(10, items.length));
                }
                
                // ËÆ°ÁÆóÊªöÂä®ÂèÇÊï∞ - Âä®ÊÄÅËé∑ÂèñitemWidth
                const isMobile = window.innerWidth <= 768;
                const isSmallMobile = window.innerWidth <= 480;
                const itemWidth = isSmallMobile ? 40 : (isMobile ? 50 : 100);
                const containerWidth = row.offsetWidth;
                const centerPosition = containerWidth / 2;
                
                const targetItemLeftEdge = targetIndex * itemWidth;
                const targetItemCenter = targetItemLeftEdge + itemWidth / 2;
                const translateAmount = centerPosition - targetItemCenter;
                
                // Ë∞ÉÊï¥È¢ùÂ§ñÊªöÂä®Ë∑ùÁ¶ªÔºåÊâãÊú∫Á´ØÂáèÂ∞ë
                const extraDistance = itemWidth * (isSmallMobile ? 10 : (isMobile ? 15 : 20));
                const finalTranslate = translateAmount - extraDistance;
                
                // ÂêØÂä®ÊªöÂä®Âä®Áîª
                setTimeout(() => {
                    strip.style.transition = 'transform 3s ease-out';
                    strip.style.transform = `translateX(${finalTranslate}px)`;
                }, 200 + i * 200);
            }
        }

        // Ê†πÊçÆÊ¶ÇÁéáÈÄâÊã©Â•ñÂìÅ
        function selectPrizeByProbability() {
            const totalProbability = prizeData.reduce((sum, prize) => sum + prize.probability, 0);
            const random = Math.random() * totalProbability;
            
            let accumulator = 0;
            for (const prize of prizeData) {
                accumulator += prize.probability;
                if (random <= accumulator) {
                    return prize;
                }
            }
            
            // Â§áÁî®ËøîÂõûÊúÄÂêé‰∏Ä‰∏™Â•ñÂìÅ
            return prizeData[prizeData.length - 1];
        }

        // ÊòæÁ§∫‰∏≠Â•ñÁªìÊûú
        function showWinResult(results, totalValue = null) {
            const modal = document.getElementById('winModal');
            const result = document.getElementById('winResult');
            
            // ‰ΩøÁî®ÂêéÁ´ØÊèê‰æõÁöÑÊÄª‰ª∑ÂÄºÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàôËÆ°ÁÆó
            const calculatedValue = totalValue || results.reduce((sum, prize) => sum + parseFloat(prize.value || 0), 0);
            const prizeNames = results.map(p => p.name).join('„ÄÅ');
            
            const prizeDisplay = results.map(prize => {
                if (prize.image_url) {
                    return `<img src="${prize.image_url}" alt="${prize.name}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 10px; margin: 0 5px;">`;
                } else {
                    return `<span style="font-size: 60px; margin: 0 5px;">${prize.icon}</span>`;
                }
            }).join('');
            
            result.innerHTML = `
                <div style="margin: 20px 0;">${prizeDisplay}</div>
                <div class="neon-text gold" style="font-size: 24px; margin: 10px 0;">${prizeNames}</div>
                <div class="neon-text green" style="font-size: 20px;">
                    ÊÅ≠ÂñúËé∑ÂæóÊÄª‰ª∑ÂÄº: ${parseFloat(calculatedValue).toFixed(2)} ÁöÑÂ•ñÂìÅÔºÅ
                </div>
            `;
            
            modal.classList.add('show');
        }

        // ÁîüÊàêÂ•ñÂìÅËØ¥ÊòéÁΩëÊ†º
        function generatePrizeGrid() {
            const prizeGrid = document.getElementById('prizeGrid');
            
            prizeGrid.innerHTML = prizeData.map(prize => `
                <div class="prize-item ${prize.rarity}">
                    <div class="prize-display">
                        ${prize.image_url ? 
                            `<img src="${prize.image_url}" alt="${prize.name}" class="prize-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                             <span class="prize-icon" style="display:none;">${prize.icon}</span>` :
                            `<span class="prize-icon">${prize.icon}</span>`
                        }
                    </div>
                    <span class="prize-name">${prize.name}</span>
                    <span class="prize-value">‰ª∑ÂÄº: ${prize.value}</span>
                    <span class="prize-rarity">${getRarityText(prize.rarity)}</span>
                    <span class="prize-probability">Ê¶ÇÁéá: ${prize.probability}%</span>
                </div>
            `).join('');
        }

        // Ëé∑ÂèñÁ®ÄÊúâÂ∫¶ÊñáÊú¨
        function getRarityText(rarity) {
            const rarityMap = {
                'common': 'ÊôÆÈÄö',
                'rare': 'Á®ÄÊúâ', 
                'epic': 'Âè≤ËØó',
                'legendary': '‰º†ËØ¥'
            };
            return rarityMap[rarity] || 'ÊôÆÈÄö';
        }

        // ÂÖ≥Èó≠‰∏≠Â•ñÂºπÁ™ó
        function closeWinModal() {
            document.getElementById('winModal').classList.remove('show');
            
            // Á°Æ‰øùÊâÄÊúâstripÈÉΩÈáçÁΩÆÂà∞ÂàùÂßã‰ΩçÁΩÆ
            const allStrips = document.querySelectorAll('.slot-strip');
            allStrips.forEach(strip => {
                strip.style.transition = 'none';
                strip.style.transform = 'translateX(0px)';
            });
        }

        // ËøîÂõû‰∏ªÈ°µ
        function goToHome() {
            window.location.href = './main.html';
        }

        // ÈÄÄÂá∫ÁôªÂΩï
        async function logout() {
            if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü')) {
                try {
                    await api.logout();
                    window.location.href = '../pages/auth/login.html';
                } catch (error) {
                    console.error('ÈÄÄÂá∫ÁôªÂΩïÂ§±Ë¥•:', error);
                    window.location.href = '../pages/auth/login.html';
                }
            }
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÊâßË°å
        document.addEventListener('DOMContentLoaded', initPage);

        // ÁõëÂê¨Á™óÂè£Â§ßÂ∞èÂèòÂåñÔºåÈáçÊñ∞ÂàùÂßãÂåñËÄÅËôéÊú∫ÔºàÂ§ÑÁêÜÂ±èÂπïÊóãËΩ¨Á≠âÊÉÖÂÜµÔºâ
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                // ÈáçÊñ∞ÂàùÂßãÂåñËÄÅËôéÊú∫‰ª•ÈÄÇÂ∫îÊñ∞ÁöÑÂ±èÂπïÂ∞∫ÂØ∏
                if (prizeData && prizeData.length > 0) {
                    updateSlotRows();
                }
            }, 300); // Èò≤ÊäñÔºå300msÂêéÊâßË°å
        });

        // ÁõëÂê¨ËÆæÂ§áÊñπÂêëÂèòÂåñ
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                if (prizeData && prizeData.length > 0) {
                    updateSlotRows();
                }
            }, 500); // Á≠âÂæÖÊñπÂêëÂèòÂåñÂÆåÊàê
        });

        // Êñ∞Â¢ûÂäüËÉΩÂáΩÊï∞

        // ÊâìÂºÄÊØèÊó•Á≠æÂà∞
        function openCheckin() {
            generateCalendar();
            document.getElementById('checkinModal').classList.add('show');
        }

        // ÂÖ≥Èó≠ÊØèÊó•Á≠æÂà∞ÂºπÁ™ó
        function closeCheckinModal() {
            document.getElementById('checkinModal').classList.remove('show');
        }

        // ÁîüÊàêÁ≠æÂà∞Êó•ÂéÜ
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            
            // Ëé∑ÂèñÊú¨ÊúàÁ¨¨‰∏ÄÂ§©ÂíåÊúÄÂêé‰∏ÄÂ§©
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            // Ê∏ÖÁ©∫Êó•ÂéÜ
            calendarGrid.innerHTML = '';
            
            // Ê∑ªÂä†ÊòüÊúüÊ†áÈ¢ò
            const weekdays = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                dayHeader.style.fontWeight = 'bold';
                dayHeader.style.color = '#ffd700';
                calendarGrid.appendChild(dayHeader);
            });
            
            // Ê∑ªÂä†Á©∫ÁôΩÂ§©Êï∞ÔºàÊúàÂàùÔºâ
            const startDay = firstDay.getDay();
            for (let i = 0; i < startDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendarGrid.appendChild(emptyDay);
            }
            
            // Ê∑ªÂä†Êú¨ÊúàÂ§©Êï∞
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // Ê†áËÆ∞‰ªäÂ§©
                if (day === now.getDate()) {
                    dayElement.classList.add('today');
                }
                
                // Ê®°ÊãüÁ≠æÂà∞Áä∂ÊÄÅÔºàÂÆûÈôÖÂ∫îËØ•‰ªéÊúçÂä°Âô®Ëé∑ÂèñÔºâ
                if (Math.random() > 0.7) {
                    dayElement.classList.add('checked');
                    dayElement.title = 'Â∑≤Á≠æÂà∞';
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        // ÊâßË°åÁ≠æÂà∞
        async function performCheckin() {
            const btn = document.getElementById('checkinBtn');
            const originalText = btn.textContent;
            
            btn.disabled = true;
            btn.textContent = 'Á≠æÂà∞‰∏≠...';
            
            try {
                // Ê®°ÊãüÁ≠æÂà∞ËØ∑Ê±Ç
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // ÊàêÂäüÁ≠æÂà∞
                btn.textContent = 'Á≠æÂà∞ÊàêÂäüÔºÅ';
                btn.style.background = 'linear-gradient(45deg, #22c55e, #16a34a)';
                
                // Êõ¥Êñ∞Áî®Êà∑‰ΩôÈ¢ù
                setTimeout(() => {
                    loadUserInfo();
                    generateCalendar();
                }, 1000);
                
                // 3ÁßíÂêéÊÅ¢Â§çÊåâÈíÆ
                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = originalText;
                    btn.style.background = 'linear-gradient(45deg, #4ade80, #22c55e)';
                }, 3000);
                
            } catch (error) {
                console.error('Á≠æÂà∞Â§±Ë¥•:', error);
                btn.disabled = false;
                btn.textContent = 'Á≠æÂà∞Â§±Ë¥•';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            }
        }

        // ÊâìÂºÄ‰ªìÂ∫ì
        function openWarehouse() {
            loadWarehouseItems();
            document.getElementById('warehouseModal').classList.add('show');
        }

        // ÂÖ≥Èó≠‰ªìÂ∫ìÂºπÁ™ó
        function closeWarehouseModal() {
            document.getElementById('warehouseModal').classList.remove('show');
        }

        // Âä†ËΩΩ‰ªìÂ∫ìÁâ©ÂìÅ
        function loadWarehouseItems() {
            const warehouseItems = document.getElementById('warehouseItems');
            
            // Ê®°Êãü‰ªìÂ∫ìÊï∞ÊçÆ
            const items = [
                { id: 1, name: 'iPhone 15', icon: 'üì±', count: 1 },
                { id: 2, name: 'AirPods', icon: 'üéß', count: 2 },
                { id: 3, name: 'ÂÖÖÁîµÂÆù', icon: 'üîã', count: 5 },
                { id: 4, name: 'Êï∞ÊçÆÁ∫ø', icon: 'üîå', count: 3 },
                { id: 5, name: 'ÈáëÂ∏Å', icon: 'ü™ô', count: 150 },
                { id: 6, name: 'ÈíªÁü≥', icon: 'üíé', count: 8 }
            ];
            
            const itemsHtml = items.map(item => `
                <div class="warehouse-item">
                    <div class="warehouse-item-icon">${item.icon}</div>
                    <div class="warehouse-item-name">${item.name}</div>
                    <div class="warehouse-item-count">x${item.count}</div>
                </div>
            `).join('');
            
            warehouseItems.innerHTML = itemsHtml;
        }

        // ‰ªìÂ∫ìÊ†áÁ≠æÂàáÊç¢
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('tab-btn')) {
                // ÁßªÈô§ÊâÄÊúâÊ¥ªÂä®Áä∂ÊÄÅ
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                // Ê∑ªÂä†ÂΩìÂâçÊ¥ªÂä®Áä∂ÊÄÅ
                e.target.classList.add('active');
                
                // ÈáçÊñ∞Âä†ËΩΩÂØπÂ∫îÂÜÖÂÆπ
                loadWarehouseItems();
            }
        });

        // ‰∏™‰∫∫‰∏≠ÂøÉË∑≥ËΩ¨
        function goToProfile() {
            window.location.href = '../user/profile.html';
        }

        // ==================== ÈôêÊó∂ÊéâËêΩÂäüËÉΩ ====================
        let limitedDropConfig = null;
        let limitedDropPrizes = [];
        let limitedDropInterval = null;
        
        // Âä®ÊÄÅËé∑ÂèñÂΩìÂâçÈ°µÈù¢ÂêçÁß∞
        function getCurrentPageName() {
            const path = window.location.pathname;
            const filename = path.substring(path.lastIndexOf('/') + 1);
            const pageName = filename.replace('.html', '');
            
            // Â¶ÇÊûúÊòØÊ®°ÊùøÈ°µÈù¢ÔºåËøîÂõûluckytempÔºåÂê¶ÂàôËøîÂõûÂÆûÈôÖÈ°µÈù¢Âêç
            return pageName === 'luckytemp' ? 'luckytemp' : pageName;
        }
        
        const currentPageName = getCurrentPageName(); // ÂΩìÂâçÈ°µÈù¢ÂêçÁß∞
        console.log('ÂΩìÂâçÈ°µÈù¢ÂêçÁß∞:', currentPageName);

        // ÂàùÂßãÂåñÈôêÊó∂ÊéâËêΩ
        async function initLimitedDrop() {
            try {
                console.log('ÂàùÂßãÂåñÈôêÊó∂ÊéâËêΩÂäüËÉΩÔºåÈ°µÈù¢:', currentPageName);
                
                // Ëé∑ÂèñÈÖçÁΩÆ
                const configResponse = await fetch(`/server/api/limited-drop.php?action=get_config&page=${currentPageName}`);
                const configResult = await configResponse.json();
                
                if (configResult.success && configResult.config) {
                    limitedDropConfig = configResult.config;
                    console.log('ÈôêÊó∂ÊéâËêΩÈÖçÁΩÆ:', limitedDropConfig);
                    
                    // Â¶ÇÊûúÂºÄÂêØ‰∫ÜÈôêÊó∂ÊéâËêΩÔºåËé∑ÂèñÂ•ñÂìÅÊï∞ÊçÆÂπ∂ÊòæÁ§∫
                    if (limitedDropConfig.is_active) {
                        await loadLimitedDropPrizes();
                        showLimitedDropWindow();
                        
                        // ËÆæÁΩÆËá™Âä®Âà∑Êñ∞Èó¥ÈöîÔºàÊØè30ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°Êï∞ÊçÆÔºâ
                        limitedDropInterval = setInterval(async () => {
                            await loadLimitedDropPrizes();
                            updateLimitedDropDisplay();
                        }, 30000);
                    } else {
                        hideLimitedDropWindow();
                    }
                } else {
                    console.log('ÈôêÊó∂ÊéâËêΩÈÖçÁΩÆËé∑ÂèñÂ§±Ë¥•:', configResult);
                    hideLimitedDropWindow();
                }
            } catch (error) {
                console.error('ÂàùÂßãÂåñÈôêÊó∂ÊéâËêΩÂ§±Ë¥•:', error);
                hideLimitedDropWindow();
            }
        }

        // Âä†ËΩΩÈôêÊó∂ÊéâËêΩÂ•ñÂìÅ
        async function loadLimitedDropPrizes() {
            try {
                const response = await fetch(`/server/api/limited-drop.php?action=get_display_data&page=${currentPageName}`);
                const result = await response.json();
                
                if (result.success) {
                    limitedDropPrizes = result.prizes || [];
                    console.log('ÈôêÊó∂ÊéâËêΩÂ•ñÂìÅÂä†ËΩΩÊàêÂäü:', result);
                } else {
                    console.error('ÈôêÊó∂ÊéâËêΩÂ•ñÂìÅÂä†ËΩΩÂ§±Ë¥•:', result.message);
                }
            } catch (error) {
                console.error('Âä†ËΩΩÈôêÊó∂ÊéâËêΩÂ•ñÂìÅÂ§±Ë¥•:', error);
            }
        }

        // ÊòæÁ§∫ÈôêÊó∂ÊéâËêΩÁ™óÂè£
        function showLimitedDropWindow() {
            if (!limitedDropConfig?.is_active || limitedDropPrizes.length === 0) {
                console.log('ÈôêÊó∂ÊéâËêΩÊú™ÂêØÁî®ÊàñÊó†Â•ñÂìÅÊï∞ÊçÆ:', {
                    config: limitedDropConfig,
                    prizesCount: limitedDropPrizes.length
                });
                hideLimitedDropWindow();
                return;
            }

            const window = document.querySelector('.limited-drop-window');
            const body = document.body;
            
            if (window) {
                // Êõ¥Êñ∞Á™óÂè£Ê†áÈ¢ò
                const titleElement = document.getElementById('limitedDropTitle');
                if (titleElement && limitedDropConfig.window_title) {
                    titleElement.textContent = limitedDropConfig.window_title;
                }
                
                // ÊòæÁ§∫Á™óÂè£Âπ∂Ê∑ªÂä†bodyÁ±ª
                window.classList.add('show');
                window.classList.remove('collapsed');
                body.classList.add('limited-drop-active');
                updateLimitedDropDisplay();
                
                // 3ÁßíÂêéËá™Âä®Êî∂ÂõûÂà∞È°∂ÈÉ®
                setTimeout(() => {
                    window.classList.add('collapsed');
                }, 3000);
                
                console.log('ÈôêÊó∂ÊéâËêΩÁ™óÂè£Â∑≤ÊòæÁ§∫Ôºå3ÁßíÂêéÂ∞ÜËá™Âä®Êî∂Âõû');
            }
        }
        
        // ÈöêËóèÈôêÊó∂ÊéâËêΩÁ™óÂè£
        function hideLimitedDropWindow() {
            const window = document.querySelector('.limited-drop-window');
            const body = document.body;
            
            if (window) {
                window.classList.remove('show');
                body.classList.remove('limited-drop-active');
                console.log('ÈôêÊó∂ÊéâËêΩÁ™óÂè£Â∑≤ÈöêËóè');
            }
        }

        // Êõ¥Êñ∞ÈôêÊó∂ÊéâËêΩÊòæÁ§∫ÂÜÖÂÆπ
        function updateLimitedDropDisplay() {
            const container = document.querySelector('.limited-drop-prizes');
            if (!container) return;

            container.innerHTML = '';

            // Ê£ÄÊü•ÊòØÂê¶ÊâÄÊúâ‰º†ËØ¥Áâ©ÂìÅÊï∞ÈáèÈÉΩ‰∏∫0
            const allLegendaryEmpty = limitedDropPrizes.every(prize => {
                return prize.rarity !== 'legendary' || prize.quantity <= 0;
            });
            
            // Â¶ÇÊûúÊâÄÊúâ‰º†ËØ¥Áâ©ÂìÅÈÉΩÊ≤°‰∫ÜÔºåËá™Âä®ÂÖ≥Èó≠ÈôêÊó∂ÊéâËêΩ
            if (allLegendaryEmpty && limitedDropPrizes.some(p => p.rarity === 'legendary')) {
                console.log('ÊâÄÊúâ‰º†ËØ¥Áâ©ÂìÅÂ∑≤Ë¢´ÊäΩÂÆåÔºåËá™Âä®ÂÖ≥Èó≠ÈôêÊó∂ÊéâËêΩ');
                closeLimitedDropAutomatically();
                return;
            }

            limitedDropPrizes.forEach(prize => {
                const prizeElement = createLimitedDropPrizeElement(prize);
                container.appendChild(prizeElement);
            });
        }
        
        // Ëá™Âä®ÂÖ≥Èó≠ÈôêÊó∂ÊéâËêΩ
        async function closeLimitedDropAutomatically() {
            try {
                // Ë∞ÉÁî®ÂêéÁ´ØAPIÂÖ≥Èó≠ÈôêÊó∂ÊéâËêΩ
                const response = await fetch('/server/api/limited-drop.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'toggle_limited_drop',
                        page: currentPageName,
                        is_active: false
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    console.log('ÈôêÊó∂ÊéâËêΩÂ∑≤Ëá™Âä®ÂÖ≥Èó≠');
                    hideLimitedDropWindow();
                    
                    // Ê∏ÖÈô§ÂÆöÊó∂Âô®
                    if (limitedDropInterval) {
                        clearInterval(limitedDropInterval);
                        limitedDropInterval = null;
                    }
                }
            } catch (error) {
                console.error('Ëá™Âä®ÂÖ≥Èó≠ÈôêÊó∂ÊéâËêΩÂ§±Ë¥•:', error);
            }
        }

        // ÂàõÂª∫ÈôêÊó∂ÊéâËêΩÂ•ñÂìÅÂÖÉÁ¥†
        function createLimitedDropPrizeElement(prize) {
            const div = document.createElement('div');
            div.className = 'limited-drop-prize';
            
            // ‰ΩøÁî®‰ªéÊúçÂä°Âô®Ëé∑ÂèñÁöÑÁàÜÁéáÊï∞ÊçÆ
            const originalRate = prize.original_rate || '0.001';
            const boostedRate = prize.boosted_rate || '0.005';
            
            // Êï∞ÈáèË≠¶ÂëäÊ†∑Âºè
            const quantityClass = prize.quantity <= 5 ? 'quantity-warning' : '';
            
            // ‰ºòÂÖà‰ΩøÁî®ÂõæÁâáURLÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàô‰ΩøÁî®emojiÂõæÊ†á
            const prizeImageHtml = prize.image_url 
                ? `<img src="${prize.image_url}" alt="${prize.name}" class="prize-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                   <div class="prize-icon" style="display:none;">${prize.icon || 'üéÅ'}</div>`
                : `<div class="prize-icon">${prize.icon || 'üéÅ'}</div>`;
            
            div.innerHTML = `
                ${prizeImageHtml}
                <div class="prize-name">${prize.name}</div>
                <div class="prize-price">üí∞ ${prize.value || prize.price || '0'}</div>
                <div class="prize-quantity ${quantityClass}">
                    Ââ©‰Ωô: ${prize.quantity}
                </div>
                <div class="prize-boost">
                    ÁàÜÁéá: ${originalRate}% ‚Üí ${boostedRate}%
                </div>
            `;
            
            // Ê∑ªÂä†ÁÇπÂáªÊïàÊûú
            div.addEventListener('click', () => {
                console.log('ÁÇπÂáª‰∫ÜÂ•ñÂìÅ:', prize.name);
                showPrizeDetailEffect(div);
            });
            
            return div;
        }

        // Â•ñÂìÅÁÇπÂáªÁâπÊïà
        function showPrizeDetailEffect(element) {
            element.style.transform = 'translateY(-8px) scale(1.05)';
            element.style.boxShadow = '0 20px 40px rgba(255, 215, 0, 0.6)';
            
            setTimeout(() => {
                element.style.transform = '';
                element.style.boxShadow = '';
            }, 300);
        }

        // ÂÖ≥Èó≠ÈôêÊó∂ÊéâËêΩÁ™óÂè£Ôºà‰øùÁïôÂáΩÊï∞‰ΩÜ‰∏çÊâßË°åÂÖ≥Èó≠Êìç‰ΩúÔºâ
        function closeLimitedDropWindow() {
            console.log('ÈôêÊó∂ÊéâËêΩÁ™óÂè£‰∏çÂèØÂÖ≥Èó≠');
        }

        // ÊâãÂä®ÂàáÊç¢ÈôêÊó∂ÊéâËêΩÁ™óÂè£Ôºà‰ªÖÁî®‰∫éË∞ÉËØïÔºâ
        function toggleLimitedDropWindow() {
            const window = document.querySelector('.limited-drop-window');
            if (window) {
                if (window.classList.contains('show')) {
                    hideLimitedDropWindow();
                } else {
                    if (limitedDropConfig?.is_active && limitedDropPrizes.length > 0) {
                        showLimitedDropWindow();
                    } else {
                        console.log('ÈôêÊó∂ÊéâËêΩÂäüËÉΩÊú™ÂêØÁî®ÊàñÊó†Â•ñÂìÅÊï∞ÊçÆ');
                    }
                }
            }
        }

        // Ê∏ÖÁêÜÂÆöÊó∂Âô®
        window.addEventListener('beforeunload', () => {
            if (limitedDropInterval) {
                clearInterval(limitedDropInterval);
            }
        });

        // Ê∑ªÂä†ÈîÆÁõòÂø´Êç∑ÈîÆÊéßÂà∂ÔºàF2ÂàáÊç¢ÈôêÊó∂ÊéâËêΩÁ™óÂè£Ôºâ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'F2') {
                e.preventDefault();
                toggleLimitedDropWindow();
            }
        });
    </script>
</body>
</html>